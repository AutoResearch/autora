
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://autoresearch.github.io/autora/reference/autora/theorist/bms/mcmc/">
      
      
        <link rel="prev" href="../fit_prior/">
      
      
        <link rel="next" href="../parallel/">
      
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>mcmc - Automated Research Assistant</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#autoratheoristbmsmcmc" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
              <button class="md-banner__button md-icon" aria-label="Don't show this again">
                
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
              </button>
            
            
<span style="display:flex; justify-content:space-between">
<span class="show-on-small">
    <span class="twemoji right-margin show-on-small move-down">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M214.6 470.6c-12.5 12.5-32.8 12.5-45.3 0l-160-160c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L192 402.7l137.4-137.3c12.5-12.5 32.8-12.5 45.3 0s12.5 32.8 0 45.3l-160 160zm160-352-160 160c-12.5 12.5-32.8 12.5-45.3 0l-160-160c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L192 210.7 329.4 73.4c12.5-12.5 32.8-12.5 45.3 0s12.5 32.8 0 45.3z"/></svg>
    </span>
    Navigate the site here!
</span>
<span>
    Newest release: <a style="vertical-align: middle;" href="https://pypi.org/project/autora/">
        <img src="https://img.shields.io/pypi/v/autora" alt="PyPI">
    </a>
</span>
<span>
    <span class="twemoji">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 3C9.23 3 6.19 5.95 6 9.66l-1.92 2.53c-.24.31 0 .81.42.81H6v3c0 1.11.89 2 2 2h1v3h7v-4.69c2.37-1.12 4-3.51 4-6.31 0-3.86-3.12-7-7-7m1 11h-2v-2h2zm1.75-5.19c-.29.4-.66.69-1.11.93-.25.16-.42.33-.51.52-.09.18-.13.43-.13.74h-2c0-.5.11-.92.31-1.18.19-.27.54-.57 1.05-.91.26-.16.47-.36.61-.59.16-.23.23-.5.23-.82 0-.3-.08-.56-.26-.75-.18-.18-.44-.28-.75-.28a1 1 0 0 0-.66.23c-.18.16-.27.39-.28.69h-1.93l-.01-.03c-.01-.79.25-1.36.77-1.77.54-.39 1.24-.59 2.11-.59.93 0 1.66.23 2.19.68.54.45.81 1.06.81 1.82 0 .5-.15.91-.44 1.31"/></svg>
    </span>
    Questions?
    <a href="https://github.com/orgs/AutoResearch/discussions">
        Open a discussion here!
    </a>
</span>
</span>

          </div>
          
            <script>var el=document.querySelector("[data-md-component=announce]");if(el){var content=el.querySelector(".md-typeset");__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0)}</script>
          
        </aside>
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="Automated Research Assistant" class="md-header__button md-logo" aria-label="Automated Research Assistant" data-md-component="logo">
      
  <img src="../../../../../img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Automated Research Assistant
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              mcmc
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/autoresearch/autora/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="Automated Research Assistant" class="md-nav__button md-logo" aria-label="Automated Research Assistant" data-md-component="logo">
      
  <img src="../../../../../img/logo.png" alt="logo">

    </a>
    Automated Research Assistant
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/autoresearch/autora/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../tutorials/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Basic Tutorials
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Basic Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    1 - Components
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            1 - Components
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../tutorials/basic/Tutorial%20I%20Components/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../tutorials/basic/Tutorial%20Ia%20Theorists/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1a - Theorists
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../tutorials/basic/Tutorial%20Ib%20Experimentalists/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1b - Experimentalists
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../tutorials/basic/Tutorial%20II%20Loop%20Constructs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2 - Loop Constructs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../tutorials/basic/Tutorial%20III%20Functional%20Workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3 - Functional Workflow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../tutorials/basic/Tutorial%20IV%20Customization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4 - Customization
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../examples/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Use Case Tutorials
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Use Case Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../examples/closed-loop-basic/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Closed-Loop Psychophysics Study
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Closed-Loop Psychophysics Study
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../examples/closed-loop-basic/setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1 - Set Up Project
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../examples/closed-loop-basic/firebase/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2 - Set Up Firebase
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../examples/closed-loop-basic/testingzone/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3 - Connect Project With Firebase
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../examples/closed-loop-basic/init-autora/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4 - Connect Workflow With Firestore
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../examples/closed-loop-basic/experiment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5 - Generating the Experiment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../examples/closed-loop-basic/preprocessing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6 - Create Preprocessing Pipeline
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../examples/closed-loop-basic/workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7 - Update the Workflow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../examples/closed-loop-basic/prolific/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    8 - Connect Project with Prolific
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../examples/closed-loop-bandit-task/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Closed-Loop Two-Armed Bandit Study
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Closed-Loop Two-Armed Bandit Study
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../examples/closed-loop-bandit-task/setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1 - Set Up Project
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../examples/closed-loop-bandit-task/firebase/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2 - Set Up Firebase
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../examples/closed-loop-bandit-task/testingzone/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3 - Connect Project With Firebase
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../examples/closed-loop-bandit-task/init-autora/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4 - Connect Workflow With Firestore
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../examples/closed-loop-bandit-task/workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5 - Workflow Explanation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../examples/closed-loop-bandit-task/testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6 - Testing the Workflow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../examples/closed-loop-bandit-task/prolific/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7 - Connect Project with Prolific
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../examples/closed-loop-bandit-task/customization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    8 - Customization
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../terminology/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Terminology
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../cheat-sheet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cheat Sheet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../core/docs/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    States and Workflows
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            States and Workflows
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../core/docs/Variable/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AutoRA Variables
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_4_3" id="__nav_4_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    States
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4_3">
            <span class="md-nav__icon md-icon"></span>
            States
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../core/docs/The%20State%20Mechanism/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../core/docs/cycle/Basic%20Introduction%20to%20Functions%20and%20States/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic Usage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../core/docs/cycle/Combining%20Experimentalists%20with%20State/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Combining Experimentalists with States
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4_4" id="__nav_4_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Workflows with States
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4_4">
            <span class="md-nav__icon md-icon"></span>
            Workflows with States
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../core/docs/cycle/Linear%20and%20Cyclical%20Workflows%20using%20Functions%20and%20States/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../core/docs/cycle/Dynamically%20Extending%20and%20Altering%20the%20State/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dynamically Altering the State
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../core/docs/cli/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Workflows for HPCs
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_4_5" id="__nav_4_4_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4_5">
            <span class="md-nav__icon md-icon"></span>
            Workflows for HPCs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../core/docs/cli/basic-usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic Usage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../core/docs/cli/cylc-pip/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using Cylc
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../core/docs/cli/cylc-slurm-pip/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using Cylc and Slurm
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../theorist/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Theorists
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Theorists
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../user-guide/theorists/darts/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    DARTS
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_5_2" id="__nav_4_5_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5_2">
            <span class="md-nav__icon md-icon"></span>
            DARTS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/theorists/darts/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/theorists/darts/how-it-works/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How It Works
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/theorists/darts/meta-parameters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Meta Parameters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/theorists/darts/search-space/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Search Space
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5_2_6" >
        
          
          <label class="md-nav__link" for="__nav_4_5_2_6" id="__nav_4_5_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_5_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5_2_6">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/theorists/darts/Basic%20Usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic Usage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/theorists/darts/Weber%20Fechner%20Example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Weber-Fechner Law
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../user-guide/theorists/bms/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    BMS
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_5_3" id="__nav_4_5_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5_3">
            <span class="md-nav__icon md-icon"></span>
            BMS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/theorists/bms/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/theorists/bms/how-it-works/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How It Works
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/theorists/bms/meta-parameters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Meta Parameters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/theorists/bms/search-space/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Search Space
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5_3_6" >
        
          
          <label class="md-nav__link" for="__nav_4_5_3_6" id="__nav_4_5_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_5_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5_3_6">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/theorists/bms/Basic%20Usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic Usage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../user-guide/theorists/bsr/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    BSR
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_5_4" id="__nav_4_5_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5_4">
            <span class="md-nav__icon md-icon"></span>
            BSR
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/theorists/bsr/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/theorists/bsr/how-it-works/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How It Works
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/theorists/bsr/meta-parameters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Meta Parameters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/theorists/bsr/search-space/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Search Space
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_5_4_6" id="__nav_4_5_4_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_5_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5_4_6">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/theorists/bsr/Basic%20Usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic Usage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../experimentalist/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Experimentalists
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            Experimentalists
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../core/docs/pipeline/Experimentalist%20Pipeline%20Examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pipeline
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../core/docs/experimentalists/random/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Random
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_6_3" id="__nav_4_6_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_3">
            <span class="md-nav__icon md-icon"></span>
            Random
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../core/docs/experimentalists/random/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../core/docs/experimentalists/grid/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Grid
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_6_4" id="__nav_4_6_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_4">
            <span class="md-nav__icon md-icon"></span>
            Grid
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../core/docs/experimentalists/grid/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../user-guide/experimentalists/novelty/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Novelty
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_6_5" id="__nav_4_6_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_6_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_5">
            <span class="md-nav__icon md-icon"></span>
            Novelty
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/experimentalists/novelty/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6_5_3" >
        
          
          <label class="md-nav__link" for="__nav_4_6_5_3" id="__nav_4_6_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_6_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_5_3">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/experimentalists/novelty/Basic%20Usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic Usage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../user-guide/experimentalists/inequality/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Inequality
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_6_6" id="__nav_4_6_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_6_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_6">
            <span class="md-nav__icon md-icon"></span>
            Inequality
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/experimentalists/inequality/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6_6_3" >
        
          
          <label class="md-nav__link" for="__nav_4_6_6_3" id="__nav_4_6_6_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_6_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_6_3">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/experimentalists/inequality/Basic%20Usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic Usage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../user-guide/experimentalists/nearest-value/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Nearest Value
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_6_7" id="__nav_4_6_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_6_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_7">
            <span class="md-nav__icon md-icon"></span>
            Nearest Value
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/experimentalists/nearest-value/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6_7_3" >
        
          
          <label class="md-nav__link" for="__nav_4_6_7_3" id="__nav_4_6_7_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_6_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_7_3">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/experimentalists/nearest-value/Basic%20Usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic Usage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../user-guide/experimentalists/model-disagreement/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Model Disagreement
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_6_8" id="__nav_4_6_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_6_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_8">
            <span class="md-nav__icon md-icon"></span>
            Model Disagreement
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/experimentalists/model-disagreement/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6_8_3" >
        
          
          <label class="md-nav__link" for="__nav_4_6_8_3" id="__nav_4_6_8_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_6_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_8_3">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/experimentalists/model-disagreement/Basic%20Usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic Usage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../user-guide/experimentalists/uncertainty/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Uncertainty
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_6_9" id="__nav_4_6_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_6_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_9">
            <span class="md-nav__icon md-icon"></span>
            Uncertainty
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/experimentalists/uncertainty/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6_9_3" >
        
          
          <label class="md-nav__link" for="__nav_4_6_9_3" id="__nav_4_6_9_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_6_9_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_9_3">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/experimentalists/uncertainty/Basic%20Usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic Usage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6_10" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../user-guide/experimentalists/leverage/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Leverage
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_6_10" id="__nav_4_6_10_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_6_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_10">
            <span class="md-nav__icon md-icon"></span>
            Leverage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/experimentalists/leverage/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6_10_3" >
        
          
          <label class="md-nav__link" for="__nav_4_6_10_3" id="__nav_4_6_10_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_6_10_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_10_3">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/experimentalists/leverage/Basic%20Usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic Usage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6_11" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../user-guide/experimentalists/falsification/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Falsification
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_6_11" id="__nav_4_6_11_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_6_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_11">
            <span class="md-nav__icon md-icon"></span>
            Falsification
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/experimentalists/falsification/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6_11_3" >
        
          
          <label class="md-nav__link" for="__nav_4_6_11_3" id="__nav_4_6_11_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_6_11_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_11_3">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/experimentalists/falsification/Basic%20Usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic Usage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6_12" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../user-guide/experimentalists/mixture/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Mixture
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_6_12" id="__nav_4_6_12_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_6_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_12">
            <span class="md-nav__icon md-icon"></span>
            Mixture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/experimentalists/mixture/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6_12_3" >
        
          
          <label class="md-nav__link" for="__nav_4_6_12_3" id="__nav_4_6_12_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_6_12_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_12_3">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/experimentalists/mixture/basic-usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic Usage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6_13" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../user-guide/experimentalists/prediction-filter/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Prediction Filter
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_6_13" id="__nav_4_6_13_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_6_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_13">
            <span class="md-nav__icon md-icon"></span>
            Prediction Filter
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/experimentalists/prediction-filter/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6_13_3" >
        
          
          <label class="md-nav__link" for="__nav_4_6_13_3" id="__nav_4_6_13_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_6_13_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_13_3">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/experimentalists/prediction-filter/Basic%20Usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic Usage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/experimentalists/prediction-filter/Usage%20On%20State/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Usage On State
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6_14" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../user-guide/experimentalists/bandit-random/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Bandit Random
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_6_14" id="__nav_4_6_14_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_6_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_14">
            <span class="md-nav__icon md-icon"></span>
            Bandit Random
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/experimentalists/bandit-random/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6_14_3" >
        
          
          <label class="md-nav__link" for="__nav_4_6_14_3" id="__nav_4_6_14_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_6_14_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_14_3">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/experimentalists/bandit-random/Basic%20Usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic Usage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../experiment-runner/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Experiment Runners
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_7" id="__nav_4_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            Experiment Runners
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../synthetic/docs/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Synthetic
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_7_2" id="__nav_4_7_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7_2">
            <span class="md-nav__icon md-icon"></span>
            Synthetic
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../synthetic/docs/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7_2_3" >
        
          
          <label class="md-nav__link" for="__nav_4_7_2_3" id="__nav_4_7_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Example
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_7_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7_2_3">
            <span class="md-nav__icon md-icon"></span>
            Example
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7_2_3_1" >
        
          
          <label class="md-nav__link" for="__nav_4_7_2_3_1" id="__nav_4_7_2_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Abstract
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_4_7_2_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7_2_3_1">
            <span class="md-nav__icon md-icon"></span>
            Abstract
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../synthetic/docs/Examples/Abstract/LMM/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LMM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../abstract-equation/docs/Basic%20Usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic Equation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../abstract-equation/docs/Equation%20Sampler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Equation Sampling
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7_2_3_2" >
        
          
          <label class="md-nav__link" for="__nav_4_7_2_3_2" id="__nav_4_7_2_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Economics
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_4_7_2_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7_2_3_2">
            <span class="md-nav__icon md-icon"></span>
            Economics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../synthetic/docs/Examples/Economics/Expected-Value-Theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Expected Value Theory
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../synthetic/docs/Examples/Economics/Prospect-Theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prospect Theory
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7_2_3_3" >
        
          
          <label class="md-nav__link" for="__nav_4_7_2_3_3" id="__nav_4_7_2_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Neuroscience
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_4_7_2_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7_2_3_3">
            <span class="md-nav__icon md-icon"></span>
            Neuroscience
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../synthetic/docs/Examples/Neuroscience/Task-Switching/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Task Switching
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7_2_3_4" >
        
          
          <label class="md-nav__link" for="__nav_4_7_2_3_4" id="__nav_4_7_2_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Psychology
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_4_7_2_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7_2_3_4">
            <span class="md-nav__icon md-icon"></span>
            Psychology
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../synthetic/docs/Examples/Psychology/Exponential-Learning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exponential Learning
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../synthetic/docs/Examples/Psychology/Luce-Choice-Ratio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Luce Choice Ratio
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../synthetic/docs/Examples/Psychology/Q-Learning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Q Learning
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7_2_3_5" >
        
          
          <label class="md-nav__link" for="__nav_4_7_2_3_5" id="__nav_4_7_2_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Psychophysics
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_4_7_2_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7_2_3_5">
            <span class="md-nav__icon md-icon"></span>
            Psychophysics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../synthetic/docs/Examples/Psychophysics/Weber-Fechner-Law/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Weber Fechner Law
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../experiment-runner/behavioral/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Behavioral Web Experiments
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_7_3" id="__nav_4_7_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7_3">
            <span class="md-nav__icon md-icon"></span>
            Behavioral Web Experiments
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../experiment-runner/behavioral/example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Example
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../experiment-runner/behavioral/firebase/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using Firebase
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7_3_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../user-guide/experiment-runners/behavioral-web-experiments/firebase-prolific-runner/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Firebase-Prolific Runner
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_7_3_4" id="__nav_4_7_3_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_7_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7_3_4">
            <span class="md-nav__icon md-icon"></span>
            Firebase-Prolific Runner
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/experiment-runners/behavioral-web-experiments/firebase-prolific-runner/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7_3_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_7_3_4_3" id="__nav_4_7_3_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_4_7_3_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7_3_4_3">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/experiment-runners/behavioral-web-experiments/firebase-prolific-runner/Basic%20Usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic Usage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7_3_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../user-guide/experiment-runners/behavioral-web-experiments/firebase-experimentation-manager/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Firebase Experimentation Manager
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_7_3_5" id="__nav_4_7_3_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_7_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7_3_5">
            <span class="md-nav__icon md-icon"></span>
            Firebase Experimentation Manager
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/experiment-runners/behavioral-web-experiments/firebase-experimentation-manager/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7_3_5_3" >
        
          
          <label class="md-nav__link" for="__nav_4_7_3_5_3" id="__nav_4_7_3_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_4_7_3_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7_3_5_3">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/experiment-runners/behavioral-web-experiments/firebase-experimentation-manager/SweetPea/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SweetPea
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7_3_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../user-guide/experiment-runners/behavioral-web-experiments/prolific-recruitment-manager/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Prolific Recruitment Manager
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_7_3_6" id="__nav_4_7_3_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_7_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7_3_6">
            <span class="md-nav__icon md-icon"></span>
            Prolific Recruitment Manager
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/experiment-runners/behavioral-web-experiments/prolific-recruitment-manager/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7_3_6_3" >
        
          
          <label class="md-nav__link" for="__nav_4_7_3_6_3" id="__nav_4_7_3_6_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_4_7_3_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7_3_6_3">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../user-guide/experiment-runners/behavioral-web-experiments/prolific-recruitment-manager/Basic%20Usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic Usage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../contribute/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Contributor Guide
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Contributor Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../contribute/modules/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Modules
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../contribute/modules/theorist/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Theorist
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../contribute/modules/experimentalist/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Experimentalist
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../contribute/modules/experiment-runner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Experiment Runner
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../contribute/core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Core
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../contribute/Notebook/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Notebooks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../contribute/setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Development Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../contribute/pre-commit-hooks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pre-Commit Hooks
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Code Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Code Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" checked>
        
          
          <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    autora
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6_1">
            <span class="md-nav__icon md-icon"></span>
            autora
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_1" >
        
          
          <label class="md-nav__link" for="__nav_6_1_1" id="__nav_6_1_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    experiment_runner
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_1">
            <span class="md-nav__icon md-icon"></span>
            experiment_runner
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_1_1" >
        
          
          <label class="md-nav__link" for="__nav_6_1_1_1" id="__nav_6_1_1_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    synthetic
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_1_1">
            <span class="md-nav__icon md-icon"></span>
            synthetic
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_1_1_1" >
        
          
          <label class="md-nav__link" for="__nav_6_1_1_1_1" id="__nav_6_1_1_1_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    abstract
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_6_1_1_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_1_1_1">
            <span class="md-nav__icon md-icon"></span>
            abstract
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_1_1_1_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../experiment_runner/synthetic/abstract/equation/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    equation
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_6_1_1_1_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_1_1_1_1">
            <span class="md-nav__icon md-icon"></span>
            equation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../experiment_runner/synthetic/abstract/lmm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    lmm
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../experiment_runner/synthetic/abstract/template_experiment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    template_experiment
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_1_1_2" >
        
          
          <label class="md-nav__link" for="__nav_6_1_1_1_2" id="__nav_6_1_1_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    economics
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_6_1_1_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_1_1_2">
            <span class="md-nav__icon md-icon"></span>
            economics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../experiment_runner/synthetic/economics/expected_value_theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    expected_value_theory
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../experiment_runner/synthetic/economics/prospect_theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    prospect_theory
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_1_1_3" >
        
          
          <label class="md-nav__link" for="__nav_6_1_1_1_3" id="__nav_6_1_1_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    neuroscience
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_6_1_1_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_1_1_3">
            <span class="md-nav__icon md-icon"></span>
            neuroscience
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../experiment_runner/synthetic/neuroscience/task_switching/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    task_switching
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_1_1_4" >
        
          
          <label class="md-nav__link" for="__nav_6_1_1_1_4" id="__nav_6_1_1_1_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    psychology
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_6_1_1_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_1_1_4">
            <span class="md-nav__icon md-icon"></span>
            psychology
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../experiment_runner/synthetic/psychology/exp_learning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    exp_learning
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../experiment_runner/synthetic/psychology/luce_choice_ratio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    luce_choice_ratio
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../experiment_runner/synthetic/psychology/q_learning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    q_learning
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_1_1_5" >
        
          
          <label class="md-nav__link" for="__nav_6_1_1_1_5" id="__nav_6_1_1_1_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    psychophysics
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_6_1_1_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_1_1_5">
            <span class="md-nav__icon md-icon"></span>
            psychophysics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../experiment_runner/synthetic/psychophysics/stevens_power_law/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    stevens_power_law
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../experiment_runner/synthetic/psychophysics/weber_fechner_law/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    weber_fechner_law
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../experiment_runner/synthetic/utilities/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    utilities
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_1_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../experiment_runner/firebase_prolific/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    firebase_prolific
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_1_2">
            <span class="md-nav__icon md-icon"></span>
            firebase_prolific
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_2" >
        
          
          <label class="md-nav__link" for="__nav_6_1_2" id="__nav_6_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    experimentalist
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_2">
            <span class="md-nav__icon md-icon"></span>
            experimentalist
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_2_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../experimentalist/bandit_random/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    bandit_random
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_2_1">
            <span class="md-nav__icon md-icon"></span>
            bandit_random
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../experimentalist/grid/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    grid
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../experimentalist/pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pipeline
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../experimentalist/random/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    random
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../experimentalist/utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_2_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../experimentalist/model_disagreement/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    model_disagreement
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_2_6">
            <span class="md-nav__icon md-icon"></span>
            model_disagreement
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_2_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../experimentalist/falsification/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    falsification
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_2_7" id="__nav_6_1_2_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_2_7">
            <span class="md-nav__icon md-icon"></span>
            falsification
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../experimentalist/falsification/popper_net/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    popper_net
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../experimentalist/falsification/utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_2_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../experimentalist/inequality/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    inequality
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_2_8">
            <span class="md-nav__icon md-icon"></span>
            inequality
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_2_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../experimentalist/leverage/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    leverage
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_2_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_2_9">
            <span class="md-nav__icon md-icon"></span>
            leverage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_2_10" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../experimentalist/mixture/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    mixture
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_2_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_2_10">
            <span class="md-nav__icon md-icon"></span>
            mixture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_2_11" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../experimentalist/nearest_value/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    nearest_value
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_2_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_2_11">
            <span class="md-nav__icon md-icon"></span>
            nearest_value
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_2_12" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../experimentalist/novelty/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    novelty
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_2_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_2_12">
            <span class="md-nav__icon md-icon"></span>
            novelty
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_2_13" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../experimentalist/prediction_filter/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    prediction_filter
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_2_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_2_13">
            <span class="md-nav__icon md-icon"></span>
            prediction_filter
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_2_14" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../experimentalist/uncertainty/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    uncertainty
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_2_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_2_14">
            <span class="md-nav__icon md-icon"></span>
            uncertainty
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_3" checked>
        
          
          <label class="md-nav__link" for="__nav_6_1_3" id="__nav_6_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    theorist
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_1_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6_1_3">
            <span class="md-nav__icon md-icon"></span>
            theorist
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_3_1" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    bms
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_3_1" id="__nav_6_1_3_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_3_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6_1_3_1">
            <span class="md-nav__icon md-icon"></span>
            bms
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fit_prior/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fit_prior
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    mcmc
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    mcmc
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc" class="md-nav__link">
    <span class="md-ellipsis">
      mcmc
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Node" class="md-nav__link">
    <span class="md-ellipsis">
      Node
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Node">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Node.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Node.pr" class="md-nav__link">
    <span class="md-ellipsis">
      pr
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree" class="md-nav__link">
    <span class="md-ellipsis">
      Tree
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tree">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.build_et_space" class="md-nav__link">
    <span class="md-ellipsis">
      build_et_space
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.build_rr_space" class="md-nav__link">
    <span class="md-ellipsis">
      build_rr_space
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.canonical" class="md-nav__link">
    <span class="md-ellipsis">
      canonical
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.dE_et" class="md-nav__link">
    <span class="md-ellipsis">
      dE_et
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.dE_lr" class="md-nav__link">
    <span class="md-ellipsis">
      dE_lr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.dE_rr" class="md-nav__link">
    <span class="md-ellipsis">
      dE_rr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.et_replace" class="md-nav__link">
    <span class="md-ellipsis">
      et_replace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.get_bic" class="md-nav__link">
    <span class="md-ellipsis">
      get_bic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.get_energy" class="md-nav__link">
    <span class="md-ellipsis">
      get_energy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.get_sse" class="md-nav__link">
    <span class="md-ellipsis">
      get_sse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.is_root_prunable" class="md-nav__link">
    <span class="md-ellipsis">
      is_root_prunable
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.latex" class="md-nav__link">
    <span class="md-ellipsis">
      latex
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.mcmc" class="md-nav__link">
    <span class="md-ellipsis">
      mcmc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.mcmc_step" class="md-nav__link">
    <span class="md-ellipsis">
      mcmc_step
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.pr" class="md-nav__link">
    <span class="md-ellipsis">
      pr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.predict" class="md-nav__link">
    <span class="md-ellipsis">
      predict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.prune_root" class="md-nav__link">
    <span class="md-ellipsis">
      prune_root
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.replace_root" class="md-nav__link">
    <span class="md-ellipsis">
      replace_root
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.trace_predict" class="md-nav__link">
    <span class="md-ellipsis">
      trace_predict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.update_representative" class="md-nav__link">
    <span class="md-ellipsis">
      update_representative
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../parallel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    parallel
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../prior/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    prior
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../regressor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    regressor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_3_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../bsr/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    bsr
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_3_2" id="__nav_6_1_3_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_3_2">
            <span class="md-nav__icon md-icon"></span>
            bsr
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bsr/funcs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    funcs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bsr/misc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    misc
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bsr/node/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    node
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bsr/operation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    operation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bsr/prior/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    prior
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bsr/regressor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    regressor
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_3_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../darts/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    darts
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_3_3" id="__nav_6_1_3_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_3_3">
            <span class="md-nav__icon md-icon"></span>
            darts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../darts/architect/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    architect
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../darts/dataset/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    dataset
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../darts/fan_out/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fan_out
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../darts/model_search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    model_search
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../darts/operations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    operations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../darts/regressor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    regressor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../darts/utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../darts/visualize/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    visualize
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../serializer/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    serializer
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_4" id="__nav_6_1_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_4">
            <span class="md-nav__icon md-icon"></span>
            serializer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../serializer/yaml_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    yaml_
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../state/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    state
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_6" >
        
          
          <label class="md-nav__link" for="__nav_6_1_6" id="__nav_6_1_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_6">
            <span class="md-nav__icon md-icon"></span>
            utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/deprecation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    deprecation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/dictionary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    dictionary
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../variable/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    variable
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_7" id="__nav_6_1_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_7">
            <span class="md-nav__icon md-icon"></span>
            variable
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../variable/time/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    time
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_8" >
        
          
          <label class="md-nav__link" for="__nav_6_1_8" id="__nav_6_1_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    workflow
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_1_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_8">
            <span class="md-nav__icon md-icon"></span>
            workflow
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../workflow/__main__/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    __main__
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc" class="md-nav__link">
    <span class="md-ellipsis">
      mcmc
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Node" class="md-nav__link">
    <span class="md-ellipsis">
      Node
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Node">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Node.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Node.pr" class="md-nav__link">
    <span class="md-ellipsis">
      pr
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree" class="md-nav__link">
    <span class="md-ellipsis">
      Tree
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tree">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.build_et_space" class="md-nav__link">
    <span class="md-ellipsis">
      build_et_space
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.build_rr_space" class="md-nav__link">
    <span class="md-ellipsis">
      build_rr_space
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.canonical" class="md-nav__link">
    <span class="md-ellipsis">
      canonical
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.dE_et" class="md-nav__link">
    <span class="md-ellipsis">
      dE_et
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.dE_lr" class="md-nav__link">
    <span class="md-ellipsis">
      dE_lr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.dE_rr" class="md-nav__link">
    <span class="md-ellipsis">
      dE_rr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.et_replace" class="md-nav__link">
    <span class="md-ellipsis">
      et_replace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.get_bic" class="md-nav__link">
    <span class="md-ellipsis">
      get_bic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.get_energy" class="md-nav__link">
    <span class="md-ellipsis">
      get_energy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.get_sse" class="md-nav__link">
    <span class="md-ellipsis">
      get_sse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.is_root_prunable" class="md-nav__link">
    <span class="md-ellipsis">
      is_root_prunable
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.latex" class="md-nav__link">
    <span class="md-ellipsis">
      latex
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.mcmc" class="md-nav__link">
    <span class="md-ellipsis">
      mcmc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.mcmc_step" class="md-nav__link">
    <span class="md-ellipsis">
      mcmc_step
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.pr" class="md-nav__link">
    <span class="md-ellipsis">
      pr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.predict" class="md-nav__link">
    <span class="md-ellipsis">
      predict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.prune_root" class="md-nav__link">
    <span class="md-ellipsis">
      prune_root
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.replace_root" class="md-nav__link">
    <span class="md-ellipsis">
      replace_root
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.trace_predict" class="md-nav__link">
    <span class="md-ellipsis">
      trace_predict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autora.theorist.bms.mcmc.Tree.update_representative" class="md-nav__link">
    <span class="md-ellipsis">
      update_representative
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                


                  


  
  


<h1 id="autoratheoristbmsmcmc">autora.theorist.bms.mcmc</h1>


<div class="doc doc-object doc-module">



<a id="autora.theorist.bms.mcmc"></a>
    <div class="doc doc-contents first">

        <p>A Markov-Chain Monte-Carlo module.</p>


<details class="module-constants" open>
  <summary>Module constants</summary>
  <p><code>get_ops()</code>:
    A dictionary of accepted operations: <code>{operation_name: offspring}</code></p>
<pre><code>`operation_name`: the operation name, e.g. 'sin' for the sinusoid function

`offspring`: the number of arguments the function requires.

For instance, `get_ops() = {"sin": 1, "**": 2 }` means for
`sin` the function call looks like `sin(x1)` whereas for
the exponentiation operator `**`, the function call looks like `x1 ** x2`
</code></pre>
</details>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="autora.theorist.bms.mcmc.Node" class="doc doc-heading">
            <code>Node</code>


</h2>


    <div class="doc doc-contents ">


        <p>Object that holds algebraic term. This could be a function, variable, or parameter.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="autora.theorist.bms.mcmc.Node.order">order</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of children nodes this term has
    e.g. cos(x) has one child, whereas add(x,y) has two children</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>temp_dir/bms/src/autora/theorist/bms/mcmc.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Node</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Object that holds algebraic term. This could be a function, variable, or parameter.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        order: number of children nodes this term has</span>
<span class="sd">                e.g. cos(x) has one child, whereas add(x,y) has two children</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offspring</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialises the node object.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            parent: parent node - unless this node is the root, this will be whichever node contains</span>
<span class="sd">                    the function this node&#39;s term is most immediately nested within</span>
<span class="sd">                    e.g. f(x) is the parent of g(x) in f(g(x))</span>
<span class="sd">            offspring: list of child nodes</span>
<span class="sd">            value: the specific term held by this node</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span> <span class="n">Node</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offspring</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Node</span><span class="p">]</span> <span class="o">=</span> <span class="n">offspring</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offspring</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">custom_ops</span><span class="p">,</span> <span class="n">show_pow</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts expression in readable form</span>

<span class="sd">        Returns: String</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offspring</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offspring</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">custom_ops</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;(</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">offspring</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="n">custom_ops</span><span class="o">=</span><span class="n">custom_ops</span><span class="p">,</span> <span class="n">show_pow</span><span class="o">=</span><span class="n">show_pow</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">offspring</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="n">custom_ops</span><span class="o">=</span><span class="n">custom_ops</span><span class="p">,</span> <span class="n">show_pow</span><span class="o">=</span><span class="n">show_pow</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">show_pow</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="n">o</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="n">custom_ops</span><span class="o">=</span><span class="n">custom_ops</span><span class="p">,</span> <span class="n">show_pow</span><span class="o">=</span><span class="n">show_pow</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">offspring</span>
                        <span class="p">]</span>
                    <span class="p">),</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;pow2&quot;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s2">&quot;(</span><span class="si">%s</span><span class="s2"> ** 2)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">offspring</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="n">custom_ops</span><span class="o">=</span><span class="n">custom_ops</span><span class="p">,</span> <span class="n">show_pow</span><span class="o">=</span><span class="n">show_pow</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;pow3&quot;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s2">&quot;(</span><span class="si">%s</span><span class="s2"> ** 3)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">offspring</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="n">custom_ops</span><span class="o">=</span><span class="n">custom_ops</span><span class="p">,</span> <span class="n">show_pow</span><span class="o">=</span><span class="n">show_pow</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                            <span class="p">[</span>
                                <span class="n">o</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="n">custom_ops</span><span class="o">=</span><span class="n">custom_ops</span><span class="p">,</span> <span class="n">show_pow</span><span class="o">=</span><span class="n">show_pow</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">offspring</span>
                            <span class="p">]</span>
                        <span class="p">),</span>
                    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="autora.theorist.bms.mcmc.Node.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offspring</span><span class="o">=</span><span class="p">[])</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialises the node object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>parent</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>parent node - unless this node is the root, this will be whichever node contains
    the function this node's term is most immediately nested within
    e.g. f(x) is the parent of g(x) in f(g(x))</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>offspring</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of child nodes</p>
              </div>
            </td>
            <td>
                  <code>[]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the specific term held by this node</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>temp_dir/bms/src/autora/theorist/bms/mcmc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offspring</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialises the node object.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        parent: parent node - unless this node is the root, this will be whichever node contains</span>
<span class="sd">                the function this node&#39;s term is most immediately nested within</span>
<span class="sd">                e.g. f(x) is the parent of g(x) in f(g(x))</span>
<span class="sd">        offspring: list of child nodes</span>
<span class="sd">        value: the specific term held by this node</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span> <span class="n">Node</span> <span class="o">=</span> <span class="n">parent</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">offspring</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Node</span><span class="p">]</span> <span class="o">=</span> <span class="n">offspring</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">value</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offspring</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autora.theorist.bms.mcmc.Node.pr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pr</span><span class="p">(</span><span class="n">custom_ops</span><span class="p">,</span> <span class="n">show_pow</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Converts expression in readable form</p>
<p>Returns: String</p>


            <details class="quote">
              <summary>Source code in <code>temp_dir/bms/src/autora/theorist/bms/mcmc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">custom_ops</span><span class="p">,</span> <span class="n">show_pow</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts expression in readable form</span>

<span class="sd">    Returns: String</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offspring</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offspring</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">custom_ops</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;(</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offspring</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="n">custom_ops</span><span class="o">=</span><span class="n">custom_ops</span><span class="p">,</span> <span class="n">show_pow</span><span class="o">=</span><span class="n">show_pow</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offspring</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="n">custom_ops</span><span class="o">=</span><span class="n">custom_ops</span><span class="p">,</span> <span class="n">show_pow</span><span class="o">=</span><span class="n">show_pow</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">show_pow</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">o</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="n">custom_ops</span><span class="o">=</span><span class="n">custom_ops</span><span class="p">,</span> <span class="n">show_pow</span><span class="o">=</span><span class="n">show_pow</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">offspring</span>
                    <span class="p">]</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;pow2&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;(</span><span class="si">%s</span><span class="s2"> ** 2)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">offspring</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="n">custom_ops</span><span class="o">=</span><span class="n">custom_ops</span><span class="p">,</span> <span class="n">show_pow</span><span class="o">=</span><span class="n">show_pow</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;pow3&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;(</span><span class="si">%s</span><span class="s2"> ** 3)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">offspring</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="n">custom_ops</span><span class="o">=</span><span class="n">custom_ops</span><span class="p">,</span> <span class="n">show_pow</span><span class="o">=</span><span class="n">show_pow</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="n">o</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="n">custom_ops</span><span class="o">=</span><span class="n">custom_ops</span><span class="p">,</span> <span class="n">show_pow</span><span class="o">=</span><span class="n">show_pow</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">offspring</span>
                        <span class="p">]</span>
                    <span class="p">),</span>
                <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="autora.theorist.bms.mcmc.Tree" class="doc doc-heading">
            <code>Tree</code>


</h2>


    <div class="doc doc-contents ">


        <p>Object that manages the model equation. It contains the root node, which in turn iteratively
holds children nodes. Collectively this represents the model equation tree</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="autora.theorist.bms.mcmc.Tree.root">root</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the root node of the equation tree</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autora.theorist.bms.mcmc.Tree.parameters">parameters</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the settable parameters for this trees model search</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autora.theorist.bms.mcmc.Tree.op_orders">op_orders</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>order of each function within the ops</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autora.theorist.bms.mcmc.Tree.nops">nops</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of operations of each type</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autora.theorist.bms.mcmc.Tree.move_types">move_types</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>possible combinations of function nesting</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autora.theorist.bms.mcmc.Tree.ets">ets</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>possible elementary equation trees</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autora.theorist.bms.mcmc.Tree.dist_par">dist_par</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>distinct parameters used</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autora.theorist.bms.mcmc.Tree.nodes">nodes</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>nodes of the tree (operations and leaves)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autora.theorist.bms.mcmc.Tree.et_space">et_space</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>space of all possible leaves and elementary trees</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autora.theorist.bms.mcmc.Tree.rr_space">rr_space</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>space of all possible root replacement trees</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autora.theorist.bms.mcmc.Tree.num_rr">num_rr</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of possible root replacement trees</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autora.theorist.bms.mcmc.Tree.x">x</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>independent variable data</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autora.theorist.bms.mcmc.Tree.y">y</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>depedent variable data</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autora.theorist.bms.mcmc.Tree.par_values">par_values</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The values of the model parameters (one set of values for each dataset)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autora.theorist.bms.mcmc.Tree.fit_par">fit_par</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>past successful parameter fittings</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autora.theorist.bms.mcmc.Tree.sse">sse</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>sum of squared errors (measure of goodness of fit)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autora.theorist.bms.mcmc.Tree.bic">bic</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>bayesian information criterion (measure of goodness of fit)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autora.theorist.bms.mcmc.Tree.E">E</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>total energy of model</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autora.theorist.bms.mcmc.Tree.EB">EB</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>fraction of energy derived from bic score of model</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autora.theorist.bms.mcmc.Tree.EP">EP</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>fraction of energy derived from model given prior</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="autora.theorist.bms.mcmc.Tree.representative">representative</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>representative tree for each canonical formula</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>temp_dir/bms/src/autora/theorist/bms/mcmc.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Tree</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Object that manages the model equation. It contains the root node, which in turn iteratively</span>
<span class="sd">    holds children nodes. Collectively this represents the model equation tree</span>

<span class="sd">    Attributes:</span>
<span class="sd">        root: the root node of the equation tree</span>
<span class="sd">        parameters: the settable parameters for this trees model search</span>
<span class="sd">        op_orders: order of each function within the ops</span>
<span class="sd">        nops: number of operations of each type</span>
<span class="sd">        move_types: possible combinations of function nesting</span>
<span class="sd">        ets: possible elementary equation trees</span>
<span class="sd">        dist_par: distinct parameters used</span>
<span class="sd">        nodes: nodes of the tree (operations and leaves)</span>
<span class="sd">        et_space: space of all possible leaves and elementary trees</span>
<span class="sd">        rr_space: space of all possible root replacement trees</span>
<span class="sd">        num_rr: number of possible root replacement trees</span>
<span class="sd">        x: independent variable data</span>
<span class="sd">        y: depedent variable data</span>
<span class="sd">        par_values: The values of the model parameters (one set of values for each dataset)</span>
<span class="sd">        fit_par: past successful parameter fittings</span>
<span class="sd">        sse: sum of squared errors (measure of goodness of fit)</span>
<span class="sd">        bic: bayesian information criterion (measure of goodness of fit)</span>
<span class="sd">        E: total energy of model</span>
<span class="sd">        EB: fraction of energy derived from bic score of model</span>
<span class="sd">        EP: fraction of energy derived from model given prior</span>
<span class="sd">        representative: representative tree for each canonical formula</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">prior</span><span class="p">,</span> <span class="n">ops</span> <span class="o">=</span> <span class="n">get_priors</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ops</span><span class="o">=</span><span class="n">ops</span><span class="p">,</span>
        <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
        <span class="n">parameters</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">],</span>
        <span class="n">prior_par</span><span class="o">=</span><span class="n">prior</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">BT</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">PT</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">max_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
        <span class="n">root_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">fixed_root</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">custom_ops</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialises the tree object</span>

<span class="sd">        Args:</span>
<span class="sd">            ops: allowed operations to compose equation</span>
<span class="sd">            variables: dependent variable names</span>
<span class="sd">            parameters: parameters that can be used to better fit the equation to the data</span>
<span class="sd">            prior_par: hyperparameter values over operations within ops</span>
<span class="sd">            x: dependent variables</span>
<span class="sd">            y: independent variables</span>
<span class="sd">            BT: BIC value corresponding to equation</span>
<span class="sd">            PT: prior temperature</span>
<span class="sd">            max_size: maximum size of tree (maximum number of nodes)</span>
<span class="sd">            root_value: algebraic term held at root of equation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">random_state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">seed</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>
        <span class="c1"># The variables and parameters</span>
        <span class="k">if</span> <span class="n">custom_ops</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">custom_ops</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="o">=</span> <span class="n">variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">p</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;_</span><span class="si">%s</span><span class="s2">_&quot;</span> <span class="o">%</span> <span class="n">p</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parameters</span>
        <span class="p">]</span>
        <span class="c1"># The root</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixed_root</span> <span class="o">=</span> <span class="n">fixed_root</span>
        <span class="k">if</span> <span class="n">root_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span>
                <span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">),</span> <span class="n">offspring</span><span class="o">=</span><span class="p">[],</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">root_value</span><span class="p">,</span> <span class="n">offspring</span><span class="o">=</span><span class="p">[],</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">root_order</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">signature</span><span class="p">(</span><span class="n">custom_ops</span><span class="p">[</span><span class="n">root_value</span><span class="p">])</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">root_order</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">root_order</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">offspring</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">Node</span><span class="p">(</span>
                        <span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">),</span>
                        <span class="n">offspring</span><span class="o">=</span><span class="p">[],</span>
                        <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="c1"># The possible operations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ops</span> <span class="o">=</span> <span class="n">ops</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_ops</span> <span class="o">=</span> <span class="n">custom_ops</span>
        <span class="c1"># The possible orders of the operations, move types, and move</span>
        <span class="c1"># type probabilities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op_orders</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">values</span><span class="p">())]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">permutations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">op_orders</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="c1"># Elementary trees (including leaves), indexed by order</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ets</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">o</span><span class="p">,</span> <span class="p">[])</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">op_orders</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">offspring</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">order</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">]</span>
        <span class="c1"># Distinct parameters used</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dist_par</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">([</span><span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_dist_par</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_par</span><span class="p">)</span>
        <span class="c1"># Nodes of the tree (operations + leaves)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">]</span>
        <span class="c1"># Tree size and other properties of the model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span> <span class="o">=</span> <span class="n">max_size</span>
        <span class="c1"># Space of all possible leaves and elementary trees</span>
        <span class="c1"># (dict. indexed by order)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">et_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_et_space</span><span class="p">()</span>
        <span class="c1"># Space of all possible root replacement trees</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rr_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_rr_space</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_rr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rr_space</span><span class="p">)</span>
        <span class="c1"># Number of operations of each type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nops</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([[</span><span class="n">o</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">ops</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">root_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># The parameters of the prior probability (default: 5 everywhere)</span>
        <span class="k">if</span> <span class="n">prior_par</span> <span class="o">==</span> <span class="p">{}:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="s2">&quot;Nopi_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">t</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span> <span class="o">=</span> <span class="n">prior_par</span>
        <span class="c1"># The datasets</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;d0&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;d0&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)}</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;d0&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;d0&quot;</span><span class="p">:</span> <span class="n">y</span><span class="p">}</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
            <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">ds</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;x must be either a dict or a pandas.DataFrame&quot;</span><span class="p">)</span>
        <span class="c1"># The values of the model parameters (one set of values for each dataset)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">[(</span><span class="n">ds</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="nb">dict</span><span class="p">([(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">])))</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="c1"># BIC and prior temperature</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BT</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">BT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PT</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">PT</span><span class="p">)</span>
        <span class="c1"># For fast fitting, we save past successful fits to this formula</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_par</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Goodness of fit measures</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sse</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bic</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">EB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">EP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_energy</span><span class="p">()</span>
        <span class="c1"># To control formula degeneracy (i.e. different trees that</span>
        <span class="c1"># correspond to the same canonical formula), we store the</span>
        <span class="c1"># representative tree for each canonical formula</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">representative</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">representative</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">canonical</span><span class="p">()]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">,</span>
            <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="c1"># Done</span>
        <span class="k">return</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates tree&#39;s internal representation</span>

<span class="sd">        Returns: root node representation</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="n">custom_ops</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">custom_ops</span><span class="p">)</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">pr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_pow</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns readable representation of tree&#39;s root node</span>

<span class="sd">        Returns: root node representation</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="n">custom_ops</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">custom_ops</span><span class="p">,</span> <span class="n">show_pow</span><span class="o">=</span><span class="n">show_pow</span><span class="p">)</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">canonical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provides canonical form of tree&#39;s equation so that functionally equivalent trees</span>
<span class="sd">        are made into structurally equivalent trees</span>

<span class="sd">        Return: canonical form of a tree</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cansp</span> <span class="o">=</span> <span class="n">sympify</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">can</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cansp</span><span class="p">)</span>
            <span class="n">ps</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">cansp</span><span class="o">.</span><span class="n">free_symbols</span><span class="p">])</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">):</span>
                    <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">can</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">p</span><span class="p">))</span>
            <span class="n">positions</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="n">pcount</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">:</span>
                <span class="n">can</span> <span class="o">=</span> <span class="n">can</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s2">&quot;c</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">pcount</span><span class="p">)</span>
                <span class="n">pcount</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;WARNING: Could not get canonical form for&quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                    <span class="s2">&quot;(using full form!)&quot;</span><span class="p">,</span>
                    <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">can</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">can</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">latex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        translate equation into latex</span>

<span class="sd">        Returns: canonical latex form of equation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">latex</span><span class="p">(</span><span class="n">sympify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canonical</span><span class="p">()))</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">build_et_space</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build the space of possible elementary trees,</span>
<span class="sd">        which is a dictionary indexed by the order of the elementary tree</span>

<span class="sd">        Returns: space of elementary trees</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">et_space</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">o</span><span class="p">,</span> <span class="p">[])</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">op_orders</span><span class="p">])</span>
        <span class="n">et_space</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="n">x</span><span class="p">,</span> <span class="p">[]]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">op</span><span class="p">,</span> <span class="n">noff</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">for</span> <span class="n">vs</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">et_space</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">repeat</span><span class="o">=</span><span class="n">noff</span><span class="p">):</span>
                <span class="n">et_space</span><span class="p">[</span><span class="n">noff</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">op</span><span class="p">,</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vs</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">et_space</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">build_rr_space</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build the space of possible trees for the root replacement move</span>

<span class="sd">        Returns: space of possible root replacements</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rr_space</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">op</span><span class="p">,</span> <span class="n">noff</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">noff</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">rr_space</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">op</span><span class="p">,</span> <span class="p">[]])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">vs</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">et_space</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">repeat</span><span class="o">=</span><span class="p">(</span><span class="n">noff</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)):</span>
                    <span class="n">rr_space</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">op</span><span class="p">,</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vs</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">rr_space</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">replace_root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace the root with a &quot;root replacement&quot; rr (if provided;</span>
<span class="sd">        otherwise choose one at random from self.rr_space)</span>

<span class="sd">        Returns: new root (if move was possible) or None (otherwise)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If no RR is provided, randomly choose one</span>
        <span class="k">if</span> <span class="n">rr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rr</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rr_space</span><span class="p">)</span>
        <span class="c1"># Return None if the replacement is too big</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="n">rr</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="c1"># Create the new root and replace existing root</span>
        <span class="n">newRoot</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">rr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">offspring</span><span class="o">=</span><span class="p">[],</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">newRoot</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">rr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">newRoot</span><span class="o">.</span><span class="n">order</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="n">rr</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span>
            <span class="k">raise</span>
        <span class="n">newRoot</span><span class="o">.</span><span class="n">offspring</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">newRoot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">newRoot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">oldRoot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">offspring</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">leaf</span> <span class="ow">in</span> <span class="n">rr</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">offspring</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="n">leaf</span><span class="p">,</span> <span class="n">offspring</span><span class="o">=</span><span class="p">[],</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">offspring</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">offspring</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># Add new root to elementary trees if necessary (that is, iff</span>
        <span class="c1"># the old root was a leaf)</span>
        <span class="k">if</span> <span class="n">oldRoot</span><span class="o">.</span><span class="n">offspring</span> <span class="ow">is</span> <span class="p">[]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">order</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
        <span class="c1"># Update list of distinct parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dist_par</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">([</span><span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_dist_par</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_par</span><span class="p">)</span>
        <span class="c1"># Update goodness of fit measures, if necessary</span>
        <span class="k">if</span> <span class="n">update_gof</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sse</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bic</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_energy</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_root_prunable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if the root is &quot;prunable&quot;</span>

<span class="sd">        Returns: boolean of root &quot;prunability&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">isPrunable</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">isPrunable</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">isPrunable</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">offspring</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">offspring</span> <span class="o">!=</span> <span class="p">[]:</span>
                    <span class="n">isPrunable</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">break</span>
        <span class="k">return</span> <span class="n">isPrunable</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">prune_root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cut the root and its rightmost leaves (provided they are, indeed, leaves),</span>
<span class="sd">        leaving the leftmost branch as the new tree. Returns the pruned root with the same format</span>
<span class="sd">        as the replacement roots in self.rr_space (or None if pruning was impossible)</span>

<span class="sd">        Returns: the replacement root</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if the root is &quot;prunable&quot; (and return None if not)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_root_prunable</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="c1"># Let&#39;s do it!</span>
        <span class="n">rr</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">[]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">offspring</span><span class="p">)]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">offspring</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">rr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">offspring</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Update list of distinct parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dist_par</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">([</span><span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_dist_par</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_par</span><span class="p">)</span>
        <span class="c1"># Update goodness of fit measures, if necessary</span>
        <span class="k">if</span> <span class="n">update_gof</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sse</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bic</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_energy</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="c1"># Done</span>
        <span class="k">return</span> <span class="n">rr</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_add_et</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">et_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">et</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an elementary tree replacing the node, which must be a leaf</span>

<span class="sd">        Returns: the input node</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">offspring</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="k">raise</span>
        <span class="c1"># If no ET is provided, randomly choose one (of the specified</span>
        <span class="c1"># order if given, or totally at random otherwise)</span>
        <span class="k">if</span> <span class="n">et</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">et_order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">et</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">et_space</span><span class="p">[</span><span class="n">et_order</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">all_ets</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">op_orders</span> <span class="k">if</span> <span class="n">o</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]:</span>
                    <span class="n">all_ets</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">et_space</span><span class="p">[</span><span class="n">o</span><span class="p">]</span>
                <span class="n">et</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">all_ets</span><span class="p">)</span>
                <span class="n">et_order</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">et</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">et_order</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">et</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># Update the node and its offspring</span>
        <span class="n">node</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">et</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">node</span><span class="o">.</span><span class="n">offspring</span> <span class="o">=</span> <span class="p">[</span><span class="n">Node</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">node</span><span class="p">,</span> <span class="n">offspring</span><span class="o">=</span><span class="p">[])</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">et</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="n">et_order</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">offspring</span><span class="p">)]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c1"># Add the offspring to the list of nodes</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">offspring</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="c1"># Remove the node from the list of leaves and add its offspring</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">offspring</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># Update list of distinct parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dist_par</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">([</span><span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_dist_par</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_par</span><span class="p">)</span>
        <span class="c1"># Update goodness of fit measures, if necessary</span>
        <span class="k">if</span> <span class="n">update_gof</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sse</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bic</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_energy</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">node</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_del_et</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">leaf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove an elementary tree, replacing it by a leaf</span>

<span class="sd">        Returns: input node</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">leaf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">leaf</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">et_space</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">node</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">leaf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">offspring</span><span class="p">)]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">offspring</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">node</span><span class="o">.</span><span class="n">offspring</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">is_parent_et</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">offspring</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">o</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">is_parent_et</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">is_parent_et</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">offspring</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="c1"># Update list of distinct parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dist_par</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">([</span><span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_dist_par</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_par</span><span class="p">)</span>
        <span class="c1"># Update goodness of fit measures, if necessary</span>
        <span class="k">if</span> <span class="n">update_gof</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sse</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bic</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_energy</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">node</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">et_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace one elementary tree with another one, both of arbitrary order. target is a</span>
<span class="sd">        Node and new is a tuple [node_value, [list, of, offspring, values]]</span>

<span class="sd">        Returns: target</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">oini</span><span class="p">,</span> <span class="n">ofin</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">offspring</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">new</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">oini</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">added</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_et</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">et</span><span class="o">=</span><span class="n">new</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ofin</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">added</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_del_et</span><span class="p">(</span>
                    <span class="n">target</span><span class="p">,</span> <span class="n">leaf</span><span class="o">=</span><span class="n">new</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_del_et</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                <span class="n">added</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_et</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">et</span><span class="o">=</span><span class="n">new</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="c1"># Update goodness of fit measures, if necessary</span>
        <span class="k">if</span> <span class="n">update_gof</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sse</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bic</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="c1"># Done</span>
        <span class="k">return</span> <span class="n">added</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_sse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the sum of squared errors, fitting the expression represented by the Tree</span>
<span class="sd">        to the existing data, if specified (by default, yes)</span>

<span class="sd">        Returns: sum of square errors (sse)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Return 0 if there is no data</span>
        <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span> <span class="ow">or</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sse</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="c1"># Convert the Tree into a SymPy expression</span>
        <span class="n">ex</span> <span class="o">=</span> <span class="n">sympify</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="c1"># Convert the expression to a function that can be used by</span>
        <span class="c1"># curve_fit, i.e. that takes as arguments (x, a0, a1, ..., an)</span>
        <span class="n">atomd</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ex</span><span class="o">.</span><span class="n">atoms</span><span class="p">()</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">is_Symbol</span><span class="p">])</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="n">atomd</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">atomd</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="n">atomd</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">atomd</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
        <span class="n">dic</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;fac&quot;</span><span class="p">:</span> <span class="n">scipy</span><span class="o">.</span><span class="n">special</span><span class="o">.</span><span class="n">factorial</span><span class="p">,</span>
                <span class="s2">&quot;sig&quot;</span><span class="p">:</span> <span class="n">scipy</span><span class="o">.</span><span class="n">special</span><span class="o">.</span><span class="n">expit</span><span class="p">,</span>
                <span class="s2">&quot;relu&quot;</span><span class="p">:</span> <span class="n">relu</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">custom_ops</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">flam</span> <span class="o">=</span> <span class="n">lambdify</span><span class="p">(</span>
                <span class="n">variables</span> <span class="o">+</span> <span class="n">parameters</span><span class="p">,</span>
                <span class="n">ex</span><span class="p">,</span>
                <span class="p">[</span>
                    <span class="s2">&quot;numpy&quot;</span><span class="p">,</span>
                    <span class="n">dic</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sse</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">ds</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">])</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sse</span>
        <span class="k">if</span> <span class="n">fit</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Nothing to fit</span>
                <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">[</span><span class="n">ds</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_par</span><span class="p">:</span>  <span class="c1"># Recover previously fit parameters</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_par</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Do the fit for all datasets</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fit_par</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">:</span>
                    <span class="n">this_x</span><span class="p">,</span> <span class="n">this_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ds</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">ds</span><span class="p">]</span>
                    <span class="n">xmat</span> <span class="o">=</span> <span class="p">[</span><span class="n">this_x</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">]</span>

                    <span class="k">def</span><span class="w"> </span><span class="nf">feval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">):</span>
                        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">xi</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="p">]</span>
                        <span class="k">return</span> <span class="n">flam</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># Fit the parameters</span>
                        <span class="n">res</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span>
                            <span class="n">feval</span><span class="p">,</span>
                            <span class="n">xmat</span><span class="p">,</span>
                            <span class="n">this_y</span><span class="p">,</span>
                            <span class="n">p0</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">[</span><span class="n">ds</span><span class="p">][</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">],</span>
                            <span class="n">maxfev</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="c1"># Reassign the values of the parameters</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">[</span><span class="n">ds</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                            <span class="p">[</span>
                                <span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                            <span class="p">]</span>
                        <span class="p">)</span>
                        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">[</span><span class="n">ds</span><span class="p">]:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">[</span><span class="n">ds</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
                        <span class="c1"># Save this fit</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">fit_par</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)][</span><span class="n">ds</span><span class="p">]</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">[</span><span class="n">ds</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
                        <span class="c1"># Save this (unsuccessful) fit and print warning</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">fit_par</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)][</span><span class="n">ds</span><span class="p">]</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">[</span><span class="n">ds</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span>
                                <span class="s2">&quot;#Cannot_fit:</span><span class="si">%s</span><span class="s2"> # # # # #&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                                <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
                            <span class="p">)</span>

        <span class="c1"># Sum of squared errors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sse</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">:</span>
            <span class="n">this_x</span><span class="p">,</span> <span class="n">this_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ds</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">ds</span><span class="p">]</span>
            <span class="n">xmat</span> <span class="o">=</span> <span class="p">[</span><span class="n">this_x</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">]</span>
            <span class="n">ar</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">xmat</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">[</span><span class="n">ds</span><span class="p">][</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parameters</span>
            <span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">se</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">this_y</span> <span class="o">-</span> <span class="n">flam</span><span class="p">(</span><span class="o">*</span><span class="n">ar</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">se</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">[</span><span class="n">ds</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">se</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&gt; Cannot calculate SSE for </span><span class="si">%s</span><span class="s2">: inf&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">[</span><span class="n">ds</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Complex-valued parameters are invalid&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">[</span><span class="n">ds</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

        <span class="c1"># Done</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sse</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_bic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the Bayesian information criterion (BIC) of the current expression,</span>
<span class="sd">        given the data. If reset==False, the value of self.bic will not be updated</span>
<span class="sd">        (by default, it will)</span>

<span class="sd">        Returns: Bayesian information criterion (BIC)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span> <span class="ow">or</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">reset</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bic</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="c1"># Get the sum of squared errors (fitting, if required)</span>
        <span class="n">sse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sse</span><span class="p">(</span><span class="n">fit</span><span class="o">=</span><span class="n">fit</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="c1"># Calculate the BIC</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">])</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
        <span class="n">BIC</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sse</span><span class="p">[</span><span class="n">ds</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">BIC</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">ds</span><span class="p">])</span>
                <span class="n">BIC</span> <span class="o">+=</span> <span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="n">log</span><span class="p">(</span><span class="n">sse</span><span class="p">[</span><span class="n">ds</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">reset</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bic</span> <span class="o">=</span> <span class="n">BIC</span>
        <span class="k">return</span> <span class="n">BIC</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the &quot;energy&quot; of a given formula, that is, approximate minus log-posterior</span>
<span class="sd">        of the formula given the data (the approximation coming from the use of the BIC</span>
<span class="sd">        instead of the exactly integrated likelihood)</span>

<span class="sd">        Returns: Energy of formula (as E, EB, and EP)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Contribution of the data (recalculating BIC if necessary)</span>
        <span class="k">if</span> <span class="n">bic</span><span class="p">:</span>
            <span class="n">EB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bic</span><span class="p">(</span><span class="n">reset</span><span class="o">=</span><span class="n">reset</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">EB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bic</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="c1"># Contribution from the prior</span>
        <span class="n">EP</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">op</span><span class="p">,</span> <span class="n">nop</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">EP</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span><span class="p">[</span><span class="s2">&quot;Nopi_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">op</span><span class="p">]</span> <span class="o">*</span> <span class="n">nop</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">EP</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span><span class="p">[</span><span class="s2">&quot;Nopi2_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">op</span><span class="p">]</span> <span class="o">*</span> <span class="n">nop</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="c1"># Reset the value, if necessary</span>
        <span class="k">if</span> <span class="n">reset</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EB</span> <span class="o">=</span> <span class="n">EB</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EP</span> <span class="o">=</span> <span class="n">EP</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">EB</span> <span class="o">+</span> <span class="n">EP</span>
        <span class="c1"># Done</span>
        <span class="k">return</span> <span class="n">EB</span> <span class="o">+</span> <span class="n">EP</span><span class="p">,</span> <span class="n">EB</span><span class="p">,</span> <span class="n">EP</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_representative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if we&#39;ve seen this formula before, either in its current form</span>
<span class="sd">        or in another form.</span>

<span class="sd">        *If we haven&#39;t seen it, save it and return 1.</span>

<span class="sd">        *If we have seen it and this IS the representative, just return 0.</span>

<span class="sd">        *If we have seen it and the representative has smaller energy, just return -1.</span>

<span class="sd">        *If we have seen it and the representative has higher energy, update</span>
<span class="sd">        the representatitve and return -2.</span>

<span class="sd">        Returns: Integer value (0, 1, or -1) corresponding to:</span>
<span class="sd">            0: we have seen this canonical form before</span>
<span class="sd">            1: we haven&#39;t seen this canonical form before</span>
<span class="sd">            -1: we have seen this equation&#39;s canonical form before but it isn&#39;t in that form yet</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check for canonical representative</span>
        <span class="n">canonical</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canonical</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>  <span class="c1"># We&#39;ve seen this canonical before!</span>
            <span class="n">rep</span><span class="p">,</span> <span class="n">rep_energy</span><span class="p">,</span> <span class="n">rep_par_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">representative</span><span class="p">[</span><span class="n">canonical</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># Complex-valued parameters are invalid</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>  <span class="c1"># Never seen this canonical formula before:</span>
            <span class="c1"># save it and return 1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_bic</span><span class="p">(</span><span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="n">new_energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_energy</span><span class="p">(</span><span class="n">bic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">representative</span><span class="p">[</span><span class="n">canonical</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                <span class="n">new_energy</span><span class="p">,</span>
                <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span>

        <span class="c1"># If we&#39;ve seen this canonical before, check if the</span>
        <span class="c1"># representative needs to be updated</span>
        <span class="k">if</span> <span class="n">rep</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># This IS the representative: return 0</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">dE_et</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the energy change associated to the replacement of one elementary tree</span>
<span class="sd">        with another, both of arbitrary order. &quot;target&quot; is a Node() and &quot;new&quot; is</span>
<span class="sd">        a tuple [node_value, [list, of, offspring, values]].</span>

<span class="sd">        Returns: change in energy associated with an elementary tree replacement move</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dEB</span><span class="p">,</span> <span class="n">dEP</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>

        <span class="c1"># Some terms of the acceptance (number of possible move types</span>
        <span class="c1"># from initial and final configurations), as well as checking</span>
        <span class="c1"># if the tree is canonically acceptable.</span>

        <span class="c1"># number of possible move types from initial</span>
        <span class="n">nif</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="n">oi</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="n">of</span> <span class="o">-</span> <span class="n">oi</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">oi</span><span class="p">,</span> <span class="n">of</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_types</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="c1"># replace</span>
        <span class="n">old</span> <span class="o">=</span> <span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">target</span><span class="o">.</span><span class="n">offspring</span><span class="p">]]</span>
        <span class="n">old_bic</span><span class="p">,</span> <span class="n">old_sse</span><span class="p">,</span> <span class="n">old_energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span>
        <span class="n">old_par_values</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
        <span class="n">added</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">et_replace</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="c1"># number of possible move types from final</span>
        <span class="n">nfi</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="n">oi</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="n">of</span> <span class="o">-</span> <span class="n">oi</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">oi</span><span class="p">,</span> <span class="n">of</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_types</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="c1"># check/update canonical representative</span>
        <span class="n">rep_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_representative</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rep_res</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="c1"># this formula is forbidden</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">et_replace</span><span class="p">(</span><span class="n">added</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">old_bic</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">old_sse</span><span class="p">),</span> <span class="n">old_energy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">old_par_values</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">),</span> <span class="n">nif</span><span class="p">,</span> <span class="n">nfi</span>
        <span class="c1"># leave the whole thing as it was before the back &amp; fore</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">et_replace</span><span class="p">(</span><span class="n">added</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">old_bic</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">old_sse</span><span class="p">),</span> <span class="n">old_energy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">old_par_values</span>
        <span class="c1"># Prior: change due to the numbers of each operation</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dEP</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span><span class="p">[</span><span class="s2">&quot;Nopi_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">target</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dEP</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span><span class="p">[</span><span class="s2">&quot;Nopi_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">new</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dEP</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span><span class="p">[</span><span class="s2">&quot;Nopi2_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">target</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">value</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dEP</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span><span class="p">[</span><span class="s2">&quot;Nopi2_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">new</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">new</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">new</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Data</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">bicOld</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bic</span>
            <span class="n">sseOld</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">)</span>
            <span class="n">par_valuesOld</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
            <span class="n">old</span> <span class="o">=</span> <span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">target</span><span class="o">.</span><span class="n">offspring</span><span class="p">]]</span>
            <span class="c1"># replace</span>
            <span class="n">added</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">et_replace</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="n">bicNew</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bic</span>
            <span class="n">par_valuesNew</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
            <span class="c1"># leave the whole thing as it was before the back &amp; fore</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">et_replace</span><span class="p">(</span><span class="n">added</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bic</span> <span class="o">=</span> <span class="n">bicOld</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sse</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">sseOld</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">par_valuesOld</span>
            <span class="n">dEB</span> <span class="o">+=</span> <span class="p">(</span><span class="n">bicNew</span> <span class="o">-</span> <span class="n">bicOld</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">par_valuesNew</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
        <span class="c1"># Done</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dEB</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dEB</span><span class="p">)</span>
            <span class="n">dEP</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dEP</span><span class="p">)</span>
            <span class="n">dE</span> <span class="o">=</span> <span class="n">dEB</span> <span class="o">+</span> <span class="n">dEP</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">dEB</span><span class="p">,</span> <span class="n">dEP</span><span class="p">,</span> <span class="n">dE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">return</span> <span class="n">dE</span><span class="p">,</span> <span class="n">dEB</span><span class="p">,</span> <span class="n">dEP</span><span class="p">,</span> <span class="n">par_valuesNew</span><span class="p">,</span> <span class="n">nif</span><span class="p">,</span> <span class="n">nfi</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">dE_lr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the energy change associated to a long-range move</span>
<span class="sd">        (the replacement of the value of a node. &quot;target&quot; is a Node() and &quot;new&quot; is a node_value</span>

<span class="sd">        Returns: energy change associated with a long-range move</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dEB</span><span class="p">,</span> <span class="n">dEP</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
        <span class="n">par_valuesNew</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="n">new</span><span class="p">:</span>
            <span class="c1"># Check if the new tree is canonically acceptable.</span>
            <span class="n">old</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">value</span>
            <span class="n">old_bic</span><span class="p">,</span> <span class="n">old_sse</span><span class="p">,</span> <span class="n">old_energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span>
            <span class="n">old_par_values</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
            <span class="n">target</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">new</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">old</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">new</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="c1"># check/update canonical representative</span>
            <span class="n">rep_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_representative</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rep_res</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="c1"># this formula is forbidden</span>
                <span class="n">target</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">old</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">old</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">new</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">old_bic</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">old_sse</span><span class="p">),</span> <span class="n">old_energy</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">old_par_values</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="kc">None</span>
            <span class="c1"># leave the whole thing as it was before the back &amp; fore</span>
            <span class="n">target</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">old</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">old</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">new</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">old_bic</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">old_sse</span><span class="p">),</span> <span class="n">old_energy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">old_par_values</span>

            <span class="c1"># Prior: change due to the numbers of each operation</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dEP</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span><span class="p">[</span><span class="s2">&quot;Nopi_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">target</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dEP</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span><span class="p">[</span><span class="s2">&quot;Nopi_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">new</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dEP</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span><span class="p">[</span><span class="s2">&quot;Nopi2_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">target</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">value</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dEP</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span><span class="p">[</span><span class="s2">&quot;Nopi2_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">new</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">new</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">new</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="c1"># Data</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">bicOld</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bic</span>
                <span class="n">sseOld</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">)</span>
                <span class="n">par_valuesOld</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
                <span class="n">old</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">value</span>
                <span class="n">target</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">new</span>
                <span class="n">bicNew</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bic</span><span class="p">(</span><span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                <span class="n">par_valuesNew</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
                <span class="c1"># leave the whole thing as it was before the back &amp; fore</span>
                <span class="n">target</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">old</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bic</span> <span class="o">=</span> <span class="n">bicOld</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sse</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">sseOld</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">par_valuesOld</span>
                <span class="n">dEB</span> <span class="o">+=</span> <span class="p">(</span><span class="n">bicNew</span> <span class="o">-</span> <span class="n">bicOld</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">par_valuesNew</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>

        <span class="c1"># Done</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dEB</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dEB</span><span class="p">)</span>
            <span class="n">dEP</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dEP</span><span class="p">)</span>
            <span class="n">dE</span> <span class="o">=</span> <span class="n">dEB</span> <span class="o">+</span> <span class="n">dEP</span>
            <span class="k">return</span> <span class="n">dE</span><span class="p">,</span> <span class="n">dEB</span><span class="p">,</span> <span class="n">dEP</span><span class="p">,</span> <span class="n">par_valuesNew</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="kc">None</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">dE_rr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the energy change associated to a root replacement move.</span>
<span class="sd">        If rr==None, then it returns the energy change associated to pruning the root; otherwise,</span>
<span class="sd">        it returns the energy change associated to adding the root replacement &quot;rr&quot;</span>

<span class="sd">        Returns: energy change associated with a root replacement move</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dEB</span><span class="p">,</span> <span class="n">dEP</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>

        <span class="c1"># Root pruning</span>
        <span class="k">if</span> <span class="n">rr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_root_prunable</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span>

            <span class="c1"># Check if the new tree is canonically acceptable.</span>
            <span class="c1"># replace</span>
            <span class="n">old_bic</span><span class="p">,</span> <span class="n">old_sse</span><span class="p">,</span> <span class="n">old_energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span>
            <span class="n">old_par_values</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
            <span class="n">oldrr</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">offspring</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prune_root</span><span class="p">(</span><span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="c1"># check/update canonical representative</span>
            <span class="n">rep_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_representative</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rep_res</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="c1"># this formula is forbidden</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">replace_root</span><span class="p">(</span><span class="n">rr</span><span class="o">=</span><span class="n">oldrr</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">old_bic</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">old_sse</span><span class="p">),</span> <span class="n">old_energy</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">old_par_values</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
            <span class="c1"># leave the whole thing as it was before the back &amp; fore</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">replace_root</span><span class="p">(</span><span class="n">rr</span><span class="o">=</span><span class="n">oldrr</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">old_bic</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">old_sse</span><span class="p">),</span> <span class="n">old_energy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">old_par_values</span>

            <span class="c1"># Prior: change due to the numbers of each operation</span>
            <span class="n">dEP</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span><span class="p">[</span><span class="s2">&quot;Nopi_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dEP</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span><span class="p">[</span><span class="s2">&quot;Nopi2_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
                    <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">value</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="c1"># Data correction</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">bicOld</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bic</span>
                <span class="n">sseOld</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">)</span>
                <span class="n">par_valuesOld</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
                <span class="n">oldrr</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">offspring</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]]</span>
                <span class="c1"># replace</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prune_root</span><span class="p">(</span><span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                <span class="n">bicNew</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bic</span><span class="p">(</span><span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                <span class="n">par_valuesNew</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
                <span class="c1"># leave the whole thing as it was before the back &amp; fore</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">replace_root</span><span class="p">(</span><span class="n">rr</span><span class="o">=</span><span class="n">oldrr</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bic</span> <span class="o">=</span> <span class="n">bicOld</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sse</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">sseOld</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">par_valuesOld</span>
                <span class="n">dEB</span> <span class="o">+=</span> <span class="p">(</span><span class="n">bicNew</span> <span class="o">-</span> <span class="n">bicOld</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">par_valuesNew</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
            <span class="c1"># Done</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dEB</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dEB</span><span class="p">)</span>
                <span class="n">dEP</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dEP</span><span class="p">)</span>
                <span class="n">dE</span> <span class="o">=</span> <span class="n">dEB</span> <span class="o">+</span> <span class="n">dEP</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                <span class="n">dEB</span><span class="p">,</span> <span class="n">dEP</span><span class="p">,</span> <span class="n">dE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">return</span> <span class="n">dE</span><span class="p">,</span> <span class="n">dEB</span><span class="p">,</span> <span class="n">dEP</span><span class="p">,</span> <span class="n">par_valuesNew</span>

        <span class="c1"># Root replacement</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Check if the new tree is canonically acceptable.</span>
            <span class="c1"># replace</span>
            <span class="n">old_bic</span><span class="p">,</span> <span class="n">old_sse</span><span class="p">,</span> <span class="n">old_energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span>
            <span class="n">old_par_values</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
            <span class="n">newroot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace_root</span><span class="p">(</span><span class="n">rr</span><span class="o">=</span><span class="n">rr</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">newroot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Root cannot be replaced (due to max_size)</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
            <span class="c1"># check/update canonical representative</span>
            <span class="n">rep_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_representative</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rep_res</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="c1"># this formula is forbidden</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prune_root</span><span class="p">(</span><span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">old_bic</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">old_sse</span><span class="p">),</span> <span class="n">old_energy</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">old_par_values</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
            <span class="c1"># leave the whole thing as it was before the back &amp; fore</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prune_root</span><span class="p">(</span><span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">old_bic</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">old_sse</span><span class="p">),</span> <span class="n">old_energy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">old_par_values</span>

            <span class="c1"># Prior: change due to the numbers of each operation</span>
            <span class="n">dEP</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span><span class="p">[</span><span class="s2">&quot;Nopi_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">rr</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dEP</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span><span class="p">[</span><span class="s2">&quot;Nopi2_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">rr</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">rr</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">rr</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="c1"># Data</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">bicOld</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bic</span>
                <span class="n">sseOld</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">)</span>
                <span class="n">par_valuesOld</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
                <span class="c1"># replace</span>
                <span class="n">newroot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace_root</span><span class="p">(</span><span class="n">rr</span><span class="o">=</span><span class="n">rr</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">newroot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span>
                <span class="n">bicNew</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bic</span><span class="p">(</span><span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                <span class="n">par_valuesNew</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
                <span class="c1"># leave the whole thing as it was before the back &amp; fore</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prune_root</span><span class="p">(</span><span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bic</span> <span class="o">=</span> <span class="n">bicOld</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sse</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">sseOld</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">par_valuesOld</span>
                <span class="n">dEB</span> <span class="o">+=</span> <span class="p">(</span><span class="n">bicNew</span> <span class="o">-</span> <span class="n">bicOld</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">par_valuesNew</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
            <span class="c1"># Done</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dEB</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dEB</span><span class="p">)</span>
                <span class="n">dEP</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dEP</span><span class="p">)</span>
                <span class="n">dE</span> <span class="o">=</span> <span class="n">dEB</span> <span class="o">+</span> <span class="n">dEP</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                <span class="n">dEB</span><span class="p">,</span> <span class="n">dEP</span><span class="p">,</span> <span class="n">dE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">return</span> <span class="n">dE</span><span class="p">,</span> <span class="n">dEB</span><span class="p">,</span> <span class="n">dEP</span><span class="p">,</span> <span class="n">par_valuesNew</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mcmc_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">p_rr</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">p_long</span><span class="o">=</span><span class="mf">0.45</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a single MCMC step</span>

<span class="sd">        Returns: None or expression list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">topDice</span> <span class="o">=</span> <span class="n">random</span><span class="p">()</span>
        <span class="c1"># Root replacement move</span>
        <span class="k">if</span> <span class="n">topDice</span> <span class="o">&lt;</span> <span class="n">p_rr</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
                <span class="c1"># Try to prune the root</span>
                <span class="n">dE</span><span class="p">,</span> <span class="n">dEB</span><span class="p">,</span> <span class="n">dEP</span><span class="p">,</span> <span class="n">par_valuesNew</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dE_rr</span><span class="p">(</span><span class="n">rr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                <span class="k">if</span> <span class="o">-</span><span class="n">dEB</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">BT</span> <span class="o">-</span> <span class="n">dEP</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">PT</span> <span class="o">&gt;</span> <span class="mi">300</span><span class="p">:</span>
                    <span class="n">paccept</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">paccept</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">dEB</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">BT</span> <span class="o">-</span> <span class="n">dEP</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">PT</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">num_rr</span>
                    <span class="p">)</span>
                <span class="n">dice</span> <span class="o">=</span> <span class="n">random</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">dice</span> <span class="o">&lt;</span> <span class="n">paccept</span><span class="p">:</span>
                    <span class="c1"># Accept move</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prune_root</span><span class="p">(</span><span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">par_valuesNew</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_bic</span><span class="p">(</span><span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">+=</span> <span class="n">dE</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">EB</span> <span class="o">+=</span> <span class="n">dEB</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">EP</span> <span class="o">+=</span> <span class="n">dEP</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Try to replace the root</span>
                <span class="n">newrr</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rr_space</span><span class="p">)</span>
                <span class="n">dE</span><span class="p">,</span> <span class="n">dEB</span><span class="p">,</span> <span class="n">dEP</span><span class="p">,</span> <span class="n">par_valuesNew</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dE_rr</span><span class="p">(</span><span class="n">rr</span><span class="o">=</span><span class="n">newrr</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rr</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="o">-</span><span class="n">dEB</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">BT</span> <span class="o">-</span> <span class="n">dEP</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">PT</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">paccept</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">paccept</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">paccept</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rr</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">dEB</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">BT</span> <span class="o">-</span> <span class="n">dEP</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">PT</span><span class="p">)</span>
                <span class="n">dice</span> <span class="o">=</span> <span class="n">random</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">dice</span> <span class="o">&lt;</span> <span class="n">paccept</span><span class="p">:</span>
                    <span class="c1"># Accept move</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">replace_root</span><span class="p">(</span><span class="n">rr</span><span class="o">=</span><span class="n">newrr</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">par_valuesNew</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_bic</span><span class="p">(</span><span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">+=</span> <span class="n">dE</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">EB</span> <span class="o">+=</span> <span class="n">dEB</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">EP</span> <span class="o">+=</span> <span class="n">dEP</span>

        <span class="c1"># Long-range move</span>
        <span class="k">elif</span> <span class="n">topDice</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">p_rr</span> <span class="o">+</span> <span class="n">p_long</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fixed_root</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="p">):</span>
            <span class="c1"># Choose a random node in the tree, and a random new operation</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_root</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">target</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span>
                    <span class="n">target</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
            <span class="n">nready</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">nready</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">offspring</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">new</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
                    <span class="n">nready</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="n">new</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">value</span><span class="p">]:</span>
                        <span class="n">nready</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">dE</span><span class="p">,</span> <span class="n">dEB</span><span class="p">,</span> <span class="n">dEP</span><span class="p">,</span> <span class="n">par_valuesNew</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dE_lr</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">paccept</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">dEB</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">BT</span> <span class="o">-</span> <span class="n">dEP</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">PT</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Potentially failing to set paccept properly&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">dEB</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">BT</span> <span class="o">+</span> <span class="n">dEP</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">PT</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">paccept</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="c1"># Accept move, if necessary</span>
            <span class="n">dice</span> <span class="o">=</span> <span class="n">random</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dice</span> <span class="o">&lt;</span> <span class="n">paccept</span><span class="p">:</span>
                <span class="c1"># update number of operations</span>
                <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">offspring</span> <span class="o">!=</span> <span class="p">[]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">new</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># move</span>
                <span class="n">target</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">new</span>
                <span class="c1"># recalculate distinct parameters</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dist_par</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="nb">set</span><span class="p">([</span><span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">])</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_dist_par</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_par</span><span class="p">)</span>
                <span class="c1"># update others</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">par_valuesNew</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_bic</span><span class="p">(</span><span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">+=</span> <span class="n">dE</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">EB</span> <span class="o">+=</span> <span class="n">dEB</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">EP</span> <span class="o">+=</span> <span class="n">dEP</span>

        <span class="c1"># Elementary tree (short-range) move</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">while</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_root</span> <span class="ow">and</span> <span class="n">target</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span>
                <span class="c1"># Choose a feasible move (doable and keeping size&lt;=max_size)</span>
                <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">oini</span><span class="p">,</span> <span class="n">ofin</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">move_types</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="n">oini</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="n">oini</span> <span class="o">+</span> <span class="n">ofin</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span>
                    <span class="p">):</span>
                        <span class="k">break</span>
                <span class="c1"># target and new ETs</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="n">oini</span><span class="p">])</span>
                <span class="n">new</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">et_space</span><span class="p">[</span><span class="n">ofin</span><span class="p">])</span>
            <span class="c1"># omegai and omegaf</span>
            <span class="n">omegai</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="n">oini</span><span class="p">])</span>
            <span class="n">omegaf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="n">ofin</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">ofin</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">omegaf</span> <span class="o">-=</span> <span class="n">oini</span>
            <span class="k">if</span> <span class="n">oini</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">target</span><span class="o">.</span><span class="n">parent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="n">ofin</span><span class="p">]:</span>
                <span class="n">omegaf</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="c1"># size of et_space of each type</span>
            <span class="n">si</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">et_space</span><span class="p">[</span><span class="n">oini</span><span class="p">])</span>
            <span class="n">sf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">et_space</span><span class="p">[</span><span class="n">ofin</span><span class="p">])</span>
            <span class="c1"># Probability of acceptance</span>
            <span class="n">dE</span><span class="p">,</span> <span class="n">dEB</span><span class="p">,</span> <span class="n">dEP</span><span class="p">,</span> <span class="n">par_valuesNew</span><span class="p">,</span> <span class="n">nif</span><span class="p">,</span> <span class="n">nfi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dE_et</span><span class="p">(</span>
                <span class="n">target</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
            <span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">paccept</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">float</span><span class="p">(</span><span class="n">nif</span><span class="p">)</span> <span class="o">*</span> <span class="n">omegai</span> <span class="o">*</span> <span class="n">sf</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">dEB</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">BT</span> <span class="o">-</span> <span class="n">dEP</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">PT</span><span class="p">)</span>
                <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">nfi</span><span class="p">)</span> <span class="o">*</span> <span class="n">omegaf</span> <span class="o">*</span> <span class="n">si</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">dEB</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">BT</span> <span class="o">+</span> <span class="n">dEP</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">PT</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">200</span><span class="p">:</span>
                    <span class="n">paccept</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="c1"># Accept / reject</span>
            <span class="n">dice</span> <span class="o">=</span> <span class="n">random</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dice</span> <span class="o">&lt;</span> <span class="n">paccept</span><span class="p">:</span>
                <span class="c1"># Accept move</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">et_replace</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">par_valuesNew</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_bic</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">+=</span> <span class="n">dE</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">EB</span> <span class="o">+=</span> <span class="n">dEB</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">EP</span> <span class="o">+=</span> <span class="n">dEP</span>

        <span class="c1"># Done</span>
        <span class="k">return</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mcmc</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tracefn</span><span class="o">=</span><span class="s2">&quot;trace.dat&quot;</span><span class="p">,</span>
        <span class="n">progressfn</span><span class="o">=</span><span class="s2">&quot;progress.dat&quot;</span><span class="p">,</span>
        <span class="n">write_files</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">reset_files</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">burnin</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
        <span class="n">thin</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">samples</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sample the space of formula trees using MCMC, and write the trace and some progress</span>
<span class="sd">        information to files (unless write_files is False)</span>

<span class="sd">        Returns: None or expression list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_energy</span><span class="p">(</span><span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

        <span class="c1"># Burning</span>
        <span class="k">if</span> <span class="n">progress</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# Burning in</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\b</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">50</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">burnin</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mcmc_step</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">progress</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="p">(</span><span class="n">burnin</span> <span class="o">/</span> <span class="mi">50</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="c1"># Sample</span>
        <span class="k">if</span> <span class="n">write_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">reset_files</span><span class="p">:</span>
                <span class="n">tracef</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">tracefn</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
                <span class="n">progressf</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">progressfn</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tracef</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">tracefn</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>
                <span class="n">progressf</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">progressfn</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">progress</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"># Sampling</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\b</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">50</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">thin</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mcmc_step</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">progress</span> <span class="ow">and</span> <span class="p">(</span><span class="n">s</span> <span class="o">%</span> <span class="p">(</span><span class="n">samples</span> <span class="o">/</span> <span class="mi">50</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">write_files</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">s</span><span class="p">,</span>
                        <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">),</span>
                        <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">),</span>
                        <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_energy</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)),</span>
                        <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">,</span>
                    <span class="p">],</span>
                    <span class="n">tracef</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">tracef</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">tracef</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                <span class="n">progressf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%lf</span><span class="s2"> </span><span class="si">%lf</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">))</span>
                <span class="n">progressf</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="c1"># Done</span>
        <span class="k">if</span> <span class="n">progress</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the value of the formula at the given data x. The data x</span>
<span class="sd">        must have the same format as the training data and, in particular, it</span>
<span class="sd">        it must specify to which dataset the example data belongs, if multiple</span>
<span class="sd">        datasets where used for training.</span>

<span class="sd">        Returns: predicted y values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;X&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">))</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">this_x</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;d0&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">}</span>
            <span class="n">input_type</span> <span class="o">=</span> <span class="s2">&quot;df&quot;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">this_x</span> <span class="o">=</span> <span class="n">x</span>
            <span class="n">input_type</span> <span class="o">=</span> <span class="s2">&quot;dict&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;x must be either a dict or a pandas.DataFrame&quot;</span><span class="p">)</span>

        <span class="c1"># Convert the Tree into a SymPy expression</span>
        <span class="n">ex</span> <span class="o">=</span> <span class="n">sympify</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="c1"># Convert the expression to a function</span>
        <span class="n">atomd</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ex</span><span class="o">.</span><span class="n">atoms</span><span class="p">()</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">is_Symbol</span><span class="p">])</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="n">atomd</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">atomd</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="n">atomd</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">atomd</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
        <span class="n">flam</span> <span class="o">=</span> <span class="n">lambdify</span><span class="p">(</span>
            <span class="n">variables</span> <span class="o">+</span> <span class="n">parameters</span><span class="p">,</span>
            <span class="n">ex</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s2">&quot;numpy&quot;</span><span class="p">,</span>
                <span class="nb">dict</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;fac&quot;</span><span class="p">:</span> <span class="n">scipy</span><span class="o">.</span><span class="n">special</span><span class="o">.</span><span class="n">factorial</span><span class="p">,</span>
                        <span class="s2">&quot;sig&quot;</span><span class="p">:</span> <span class="n">scipy</span><span class="o">.</span><span class="n">special</span><span class="o">.</span><span class="n">expit</span><span class="p">,</span>
                        <span class="s2">&quot;relu&quot;</span><span class="p">:</span> <span class="n">relu</span><span class="p">,</span>
                    <span class="p">},</span>
                    <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">custom_ops</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">],</span>
        <span class="p">)</span>
        <span class="c1"># Loop over datasets</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">this_x</span><span class="p">:</span>
            <span class="c1"># Prepare variables and parameters</span>
            <span class="n">xmat</span> <span class="o">=</span> <span class="p">[</span><span class="n">this_x</span><span class="p">[</span><span class="n">ds</span><span class="p">][</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">]</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">[</span><span class="n">ds</span><span class="p">][</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">]</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">xi</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">xmat</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="p">]</span>
            <span class="c1"># Predict</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">prediction</span> <span class="o">=</span> <span class="n">flam</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
                <span class="c1"># Do it point by point</span>
                <span class="n">prediction</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">this_x</span><span class="p">[</span><span class="n">ds</span><span class="p">]))]</span>
            <span class="n">predictions</span><span class="p">[</span><span class="n">ds</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">this_x</span><span class="p">[</span><span class="n">ds</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">input_type</span> <span class="o">==</span> <span class="s2">&quot;df&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;d0&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">predictions</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">trace_predict</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">x</span><span class="p">,</span>
        <span class="n">burnin</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">thin</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
        <span class="n">samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">tracefn</span><span class="o">=</span><span class="s2">&quot;trace.dat&quot;</span><span class="p">,</span>
        <span class="n">progressfn</span><span class="o">=</span><span class="s2">&quot;progress.dat&quot;</span><span class="p">,</span>
        <span class="n">write_files</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">reset_files</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sample the space of formula trees using MCMC,</span>
<span class="sd">        and predict y(x) for each of the sampled formula trees</span>

<span class="sd">        Returns: predicted y values for each of the sampled formula trees</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ypred</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Burning</span>
        <span class="k">if</span> <span class="n">progress</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# Burning in</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\b</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">50</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">burnin</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mcmc_step</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">progress</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="p">(</span><span class="n">burnin</span> <span class="o">/</span> <span class="mi">50</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="c1"># Sample</span>
        <span class="k">if</span> <span class="n">write_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">reset_files</span><span class="p">:</span>
                <span class="n">tracef</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">tracefn</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
                <span class="n">progressf</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">progressfn</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tracef</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">tracefn</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>
                <span class="n">progressf</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">progressfn</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">progress</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"># Sampling</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\b</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">50</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">thin</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mcmc_step</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="c1"># Make prediction</span>
            <span class="n">ypred</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="c1"># Output</span>
            <span class="k">if</span> <span class="n">progress</span> <span class="ow">and</span> <span class="p">(</span><span class="n">s</span> <span class="o">%</span> <span class="p">(</span><span class="n">samples</span> <span class="o">/</span> <span class="mi">50</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">write_files</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">s</span><span class="p">,</span>
                        <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">),</span>
                        <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">),</span>
                        <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_energy</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)),</span>
                        <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">,</span>
                    <span class="p">],</span>
                    <span class="n">tracef</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">tracef</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">tracef</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                <span class="n">progressf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%lf</span><span class="s2"> </span><span class="si">%lf</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">))</span>
                <span class="n">progressf</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="c1"># Done</span>
        <span class="k">if</span> <span class="n">progress</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">ypred</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="autora.theorist.bms.mcmc.Tree.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">ops</span><span class="o">=</span><span class="n">ops</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">parameters</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">],</span> <span class="n">prior_par</span><span class="o">=</span><span class="n">prior</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">BT</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">PT</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">root_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fixed_root</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">custom_ops</span><span class="o">=</span><span class="p">{},</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialises the tree object</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ops</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>allowed operations to compose equation</p>
              </div>
            </td>
            <td>
                  <code><span title="autora.theorist.bms.mcmc.Tree.ops">ops</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>variables</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dependent variable names</p>
              </div>
            </td>
            <td>
                  <code>[&#39;x&#39;]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>parameters</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>parameters that can be used to better fit the equation to the data</p>
              </div>
            </td>
            <td>
                  <code>[&#39;a&#39;]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prior_par</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>hyperparameter values over operations within ops</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="autora.theorist.bms.prior" href="../prior/#autora.theorist.bms.prior">prior</a></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dependent variables</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>independent variables</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>BT</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>BIC value corresponding to equation</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>PT</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>prior temperature</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_size</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>maximum size of tree (maximum number of nodes)</p>
              </div>
            </td>
            <td>
                  <code>50</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>root_value</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>algebraic term held at root of equation</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>temp_dir/bms/src/autora/theorist/bms/mcmc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">ops</span><span class="o">=</span><span class="n">ops</span><span class="p">,</span>
    <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
    <span class="n">parameters</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">],</span>
    <span class="n">prior_par</span><span class="o">=</span><span class="n">prior</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">BT</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">PT</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">max_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">root_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fixed_root</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">custom_ops</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialises the tree object</span>

<span class="sd">    Args:</span>
<span class="sd">        ops: allowed operations to compose equation</span>
<span class="sd">        variables: dependent variable names</span>
<span class="sd">        parameters: parameters that can be used to better fit the equation to the data</span>
<span class="sd">        prior_par: hyperparameter values over operations within ops</span>
<span class="sd">        x: dependent variables</span>
<span class="sd">        y: independent variables</span>
<span class="sd">        BT: BIC value corresponding to equation</span>
<span class="sd">        PT: prior temperature</span>
<span class="sd">        max_size: maximum size of tree (maximum number of nodes)</span>
<span class="sd">        root_value: algebraic term held at root of equation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">random_state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">seed</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>
    <span class="c1"># The variables and parameters</span>
    <span class="k">if</span> <span class="n">custom_ops</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">custom_ops</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="o">=</span> <span class="n">variables</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">p</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;_</span><span class="si">%s</span><span class="s2">_&quot;</span> <span class="o">%</span> <span class="n">p</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parameters</span>
    <span class="p">]</span>
    <span class="c1"># The root</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fixed_root</span> <span class="o">=</span> <span class="n">fixed_root</span>
    <span class="k">if</span> <span class="n">root_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span>
            <span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">),</span> <span class="n">offspring</span><span class="o">=</span><span class="p">[],</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">root_value</span><span class="p">,</span> <span class="n">offspring</span><span class="o">=</span><span class="p">[],</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">root_order</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">signature</span><span class="p">(</span><span class="n">custom_ops</span><span class="p">[</span><span class="n">root_value</span><span class="p">])</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">root_order</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">root_order</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">offspring</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">Node</span><span class="p">(</span>
                    <span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">),</span>
                    <span class="n">offspring</span><span class="o">=</span><span class="p">[],</span>
                    <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="c1"># The possible operations</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ops</span> <span class="o">=</span> <span class="n">ops</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">custom_ops</span> <span class="o">=</span> <span class="n">custom_ops</span>
    <span class="c1"># The possible orders of the operations, move types, and move</span>
    <span class="c1"># type probabilities</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">op_orders</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">values</span><span class="p">())]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">move_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">permutations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">op_orders</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
    <span class="c1"># Elementary trees (including leaves), indexed by order</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ets</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">o</span><span class="p">,</span> <span class="p">[])</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">op_orders</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">offspring</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">order</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">]</span>
    <span class="c1"># Distinct parameters used</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dist_par</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
        <span class="nb">set</span><span class="p">([</span><span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">])</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">n_dist_par</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_par</span><span class="p">)</span>
    <span class="c1"># Nodes of the tree (operations + leaves)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">]</span>
    <span class="c1"># Tree size and other properties of the model</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span> <span class="o">=</span> <span class="n">max_size</span>
    <span class="c1"># Space of all possible leaves and elementary trees</span>
    <span class="c1"># (dict. indexed by order)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">et_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_et_space</span><span class="p">()</span>
    <span class="c1"># Space of all possible root replacement trees</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rr_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_rr_space</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">num_rr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rr_space</span><span class="p">)</span>
    <span class="c1"># Number of operations of each type</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nops</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([[</span><span class="n">o</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">ops</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">root_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1"># The parameters of the prior probability (default: 5 everywhere)</span>
    <span class="k">if</span> <span class="n">prior_par</span> <span class="o">==</span> <span class="p">{}:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="s2">&quot;Nopi_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">t</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span> <span class="o">=</span> <span class="n">prior_par</span>
    <span class="c1"># The datasets</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;d0&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;d0&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)}</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;d0&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;d0&quot;</span><span class="p">:</span> <span class="n">y</span><span class="p">}</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">ds</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;x must be either a dict or a pandas.DataFrame&quot;</span><span class="p">)</span>
    <span class="c1"># The values of the model parameters (one set of values for each dataset)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="p">[(</span><span class="n">ds</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="nb">dict</span><span class="p">([(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">])))</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="c1"># BIC and prior temperature</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">BT</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">BT</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">PT</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">PT</span><span class="p">)</span>
    <span class="c1"># For fast fitting, we save past successful fits to this formula</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fit_par</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># Goodness of fit measures</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sse</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bic</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">EB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">EP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_energy</span><span class="p">()</span>
    <span class="c1"># To control formula degeneracy (i.e. different trees that</span>
    <span class="c1"># correspond to the same canonical formula), we store the</span>
    <span class="c1"># representative tree for each canonical formula</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">representative</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">representative</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">canonical</span><span class="p">()]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">,</span>
        <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="c1"># Done</span>
    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autora.theorist.bms.mcmc.Tree.__repr__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__repr__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Updates tree's internal representation</p>
<p>Returns: root node representation</p>


            <details class="quote">
              <summary>Source code in <code>temp_dir/bms/src/autora/theorist/bms/mcmc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Updates tree&#39;s internal representation</span>

<span class="sd">    Returns: root node representation</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="n">custom_ops</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">custom_ops</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autora.theorist.bms.mcmc.Tree.build_et_space" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">build_et_space</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Build the space of possible elementary trees,
which is a dictionary indexed by the order of the elementary tree</p>
<p>Returns: space of elementary trees</p>


            <details class="quote">
              <summary>Source code in <code>temp_dir/bms/src/autora/theorist/bms/mcmc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build_et_space</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build the space of possible elementary trees,</span>
<span class="sd">    which is a dictionary indexed by the order of the elementary tree</span>

<span class="sd">    Returns: space of elementary trees</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">et_space</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">o</span><span class="p">,</span> <span class="p">[])</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">op_orders</span><span class="p">])</span>
    <span class="n">et_space</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="n">x</span><span class="p">,</span> <span class="p">[]]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">op</span><span class="p">,</span> <span class="n">noff</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="k">for</span> <span class="n">vs</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">et_space</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">repeat</span><span class="o">=</span><span class="n">noff</span><span class="p">):</span>
            <span class="n">et_space</span><span class="p">[</span><span class="n">noff</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">op</span><span class="p">,</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vs</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">et_space</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autora.theorist.bms.mcmc.Tree.build_rr_space" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">build_rr_space</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Build the space of possible trees for the root replacement move</p>
<p>Returns: space of possible root replacements</p>


            <details class="quote">
              <summary>Source code in <code>temp_dir/bms/src/autora/theorist/bms/mcmc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build_rr_space</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build the space of possible trees for the root replacement move</span>

<span class="sd">    Returns: space of possible root replacements</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rr_space</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">op</span><span class="p">,</span> <span class="n">noff</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">noff</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">rr_space</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">op</span><span class="p">,</span> <span class="p">[]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">vs</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">et_space</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">repeat</span><span class="o">=</span><span class="p">(</span><span class="n">noff</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)):</span>
                <span class="n">rr_space</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">op</span><span class="p">,</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vs</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">rr_space</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autora.theorist.bms.mcmc.Tree.canonical" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">canonical</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Provides canonical form of tree's equation so that functionally equivalent trees
are made into structurally equivalent trees</p>
<p>Return: canonical form of a tree</p>


            <details class="quote">
              <summary>Source code in <code>temp_dir/bms/src/autora/theorist/bms/mcmc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">canonical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provides canonical form of tree&#39;s equation so that functionally equivalent trees</span>
<span class="sd">    are made into structurally equivalent trees</span>

<span class="sd">    Return: canonical form of a tree</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cansp</span> <span class="o">=</span> <span class="n">sympify</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="n">can</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cansp</span><span class="p">)</span>
        <span class="n">ps</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">cansp</span><span class="o">.</span><span class="n">free_symbols</span><span class="p">])</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">):</span>
                <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">can</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">p</span><span class="p">))</span>
        <span class="n">positions</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">pcount</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">:</span>
            <span class="n">can</span> <span class="o">=</span> <span class="n">can</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s2">&quot;c</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">pcount</span><span class="p">)</span>
            <span class="n">pcount</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;WARNING: Could not get canonical form for&quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                <span class="s2">&quot;(using full form!)&quot;</span><span class="p">,</span>
                <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">can</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">can</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autora.theorist.bms.mcmc.Tree.dE_et" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">dE_et</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the energy change associated to the replacement of one elementary tree
with another, both of arbitrary order. "target" is a Node() and "new" is
a tuple [node_value, [list, of, offspring, values]].</p>
<p>Returns: change in energy associated with an elementary tree replacement move</p>


            <details class="quote">
              <summary>Source code in <code>temp_dir/bms/src/autora/theorist/bms/mcmc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">dE_et</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the energy change associated to the replacement of one elementary tree</span>
<span class="sd">    with another, both of arbitrary order. &quot;target&quot; is a Node() and &quot;new&quot; is</span>
<span class="sd">    a tuple [node_value, [list, of, offspring, values]].</span>

<span class="sd">    Returns: change in energy associated with an elementary tree replacement move</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dEB</span><span class="p">,</span> <span class="n">dEP</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>

    <span class="c1"># Some terms of the acceptance (number of possible move types</span>
    <span class="c1"># from initial and final configurations), as well as checking</span>
    <span class="c1"># if the tree is canonically acceptable.</span>

    <span class="c1"># number of possible move types from initial</span>
    <span class="n">nif</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="n">oi</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="n">of</span> <span class="o">-</span> <span class="n">oi</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">oi</span><span class="p">,</span> <span class="n">of</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_types</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="c1"># replace</span>
    <span class="n">old</span> <span class="o">=</span> <span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">target</span><span class="o">.</span><span class="n">offspring</span><span class="p">]]</span>
    <span class="n">old_bic</span><span class="p">,</span> <span class="n">old_sse</span><span class="p">,</span> <span class="n">old_energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span>
    <span class="n">old_par_values</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
    <span class="n">added</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">et_replace</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="c1"># number of possible move types from final</span>
    <span class="n">nfi</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="n">oi</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="n">of</span> <span class="o">-</span> <span class="n">oi</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">oi</span><span class="p">,</span> <span class="n">of</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_types</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="c1"># check/update canonical representative</span>
    <span class="n">rep_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_representative</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rep_res</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="c1"># this formula is forbidden</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">et_replace</span><span class="p">(</span><span class="n">added</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">old_bic</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">old_sse</span><span class="p">),</span> <span class="n">old_energy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">old_par_values</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">),</span> <span class="n">nif</span><span class="p">,</span> <span class="n">nfi</span>
    <span class="c1"># leave the whole thing as it was before the back &amp; fore</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">et_replace</span><span class="p">(</span><span class="n">added</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">old_bic</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">old_sse</span><span class="p">),</span> <span class="n">old_energy</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">old_par_values</span>
    <span class="c1"># Prior: change due to the numbers of each operation</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dEP</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span><span class="p">[</span><span class="s2">&quot;Nopi_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">target</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dEP</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span><span class="p">[</span><span class="s2">&quot;Nopi_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">new</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dEP</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span><span class="p">[</span><span class="s2">&quot;Nopi2_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">target</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">value</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dEP</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span><span class="p">[</span><span class="s2">&quot;Nopi2_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">new</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">new</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">new</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># Data</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">bicOld</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bic</span>
        <span class="n">sseOld</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">)</span>
        <span class="n">par_valuesOld</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
        <span class="n">old</span> <span class="o">=</span> <span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">target</span><span class="o">.</span><span class="n">offspring</span><span class="p">]]</span>
        <span class="c1"># replace</span>
        <span class="n">added</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">et_replace</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">bicNew</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bic</span>
        <span class="n">par_valuesNew</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
        <span class="c1"># leave the whole thing as it was before the back &amp; fore</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">et_replace</span><span class="p">(</span><span class="n">added</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bic</span> <span class="o">=</span> <span class="n">bicOld</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sse</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">sseOld</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">par_valuesOld</span>
        <span class="n">dEB</span> <span class="o">+=</span> <span class="p">(</span><span class="n">bicNew</span> <span class="o">-</span> <span class="n">bicOld</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">par_valuesNew</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
    <span class="c1"># Done</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dEB</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dEB</span><span class="p">)</span>
        <span class="n">dEP</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dEP</span><span class="p">)</span>
        <span class="n">dE</span> <span class="o">=</span> <span class="n">dEB</span> <span class="o">+</span> <span class="n">dEP</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">dEB</span><span class="p">,</span> <span class="n">dEP</span><span class="p">,</span> <span class="n">dE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">return</span> <span class="n">dE</span><span class="p">,</span> <span class="n">dEB</span><span class="p">,</span> <span class="n">dEP</span><span class="p">,</span> <span class="n">par_valuesNew</span><span class="p">,</span> <span class="n">nif</span><span class="p">,</span> <span class="n">nfi</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autora.theorist.bms.mcmc.Tree.dE_lr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">dE_lr</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the energy change associated to a long-range move
(the replacement of the value of a node. "target" is a Node() and "new" is a node_value</p>
<p>Returns: energy change associated with a long-range move</p>


            <details class="quote">
              <summary>Source code in <code>temp_dir/bms/src/autora/theorist/bms/mcmc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">dE_lr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the energy change associated to a long-range move</span>
<span class="sd">    (the replacement of the value of a node. &quot;target&quot; is a Node() and &quot;new&quot; is a node_value</span>

<span class="sd">    Returns: energy change associated with a long-range move</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dEB</span><span class="p">,</span> <span class="n">dEP</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
    <span class="n">par_valuesNew</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="n">new</span><span class="p">:</span>
        <span class="c1"># Check if the new tree is canonically acceptable.</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">value</span>
        <span class="n">old_bic</span><span class="p">,</span> <span class="n">old_sse</span><span class="p">,</span> <span class="n">old_energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span>
        <span class="n">old_par_values</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
        <span class="n">target</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">new</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">old</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">new</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c1"># check/update canonical representative</span>
        <span class="n">rep_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_representative</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rep_res</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="c1"># this formula is forbidden</span>
            <span class="n">target</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">old</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">old</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">new</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">old_bic</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">old_sse</span><span class="p">),</span> <span class="n">old_energy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">old_par_values</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="kc">None</span>
        <span class="c1"># leave the whole thing as it was before the back &amp; fore</span>
        <span class="n">target</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">old</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">old</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">new</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">old_bic</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">old_sse</span><span class="p">),</span> <span class="n">old_energy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">old_par_values</span>

        <span class="c1"># Prior: change due to the numbers of each operation</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dEP</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span><span class="p">[</span><span class="s2">&quot;Nopi_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">target</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dEP</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span><span class="p">[</span><span class="s2">&quot;Nopi_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">new</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dEP</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span><span class="p">[</span><span class="s2">&quot;Nopi2_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">target</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">value</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dEP</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span><span class="p">[</span><span class="s2">&quot;Nopi2_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">new</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">new</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">new</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Data</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">bicOld</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bic</span>
            <span class="n">sseOld</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">)</span>
            <span class="n">par_valuesOld</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
            <span class="n">old</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">value</span>
            <span class="n">target</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">new</span>
            <span class="n">bicNew</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bic</span><span class="p">(</span><span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="n">par_valuesNew</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
            <span class="c1"># leave the whole thing as it was before the back &amp; fore</span>
            <span class="n">target</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">old</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bic</span> <span class="o">=</span> <span class="n">bicOld</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sse</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">sseOld</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">par_valuesOld</span>
            <span class="n">dEB</span> <span class="o">+=</span> <span class="p">(</span><span class="n">bicNew</span> <span class="o">-</span> <span class="n">bicOld</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">par_valuesNew</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>

    <span class="c1"># Done</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dEB</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dEB</span><span class="p">)</span>
        <span class="n">dEP</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dEP</span><span class="p">)</span>
        <span class="n">dE</span> <span class="o">=</span> <span class="n">dEB</span> <span class="o">+</span> <span class="n">dEP</span>
        <span class="k">return</span> <span class="n">dE</span><span class="p">,</span> <span class="n">dEB</span><span class="p">,</span> <span class="n">dEP</span><span class="p">,</span> <span class="n">par_valuesNew</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autora.theorist.bms.mcmc.Tree.dE_rr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">dE_rr</span><span class="p">(</span><span class="n">rr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the energy change associated to a root replacement move.
If rr==None, then it returns the energy change associated to pruning the root; otherwise,
it returns the energy change associated to adding the root replacement "rr"</p>
<p>Returns: energy change associated with a root replacement move</p>


            <details class="quote">
              <summary>Source code in <code>temp_dir/bms/src/autora/theorist/bms/mcmc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">dE_rr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the energy change associated to a root replacement move.</span>
<span class="sd">    If rr==None, then it returns the energy change associated to pruning the root; otherwise,</span>
<span class="sd">    it returns the energy change associated to adding the root replacement &quot;rr&quot;</span>

<span class="sd">    Returns: energy change associated with a root replacement move</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dEB</span><span class="p">,</span> <span class="n">dEP</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>

    <span class="c1"># Root pruning</span>
    <span class="k">if</span> <span class="n">rr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_root_prunable</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span>

        <span class="c1"># Check if the new tree is canonically acceptable.</span>
        <span class="c1"># replace</span>
        <span class="n">old_bic</span><span class="p">,</span> <span class="n">old_sse</span><span class="p">,</span> <span class="n">old_energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span>
        <span class="n">old_par_values</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
        <span class="n">oldrr</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">offspring</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prune_root</span><span class="p">(</span><span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="c1"># check/update canonical representative</span>
        <span class="n">rep_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_representative</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rep_res</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="c1"># this formula is forbidden</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">replace_root</span><span class="p">(</span><span class="n">rr</span><span class="o">=</span><span class="n">oldrr</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">old_bic</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">old_sse</span><span class="p">),</span> <span class="n">old_energy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">old_par_values</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
        <span class="c1"># leave the whole thing as it was before the back &amp; fore</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replace_root</span><span class="p">(</span><span class="n">rr</span><span class="o">=</span><span class="n">oldrr</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">old_bic</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">old_sse</span><span class="p">),</span> <span class="n">old_energy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">old_par_values</span>

        <span class="c1"># Prior: change due to the numbers of each operation</span>
        <span class="n">dEP</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span><span class="p">[</span><span class="s2">&quot;Nopi_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dEP</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span><span class="p">[</span><span class="s2">&quot;Nopi2_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">value</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Data correction</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">bicOld</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bic</span>
            <span class="n">sseOld</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">)</span>
            <span class="n">par_valuesOld</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
            <span class="n">oldrr</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">offspring</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]]</span>
            <span class="c1"># replace</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prune_root</span><span class="p">(</span><span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="n">bicNew</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bic</span><span class="p">(</span><span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="n">par_valuesNew</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
            <span class="c1"># leave the whole thing as it was before the back &amp; fore</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">replace_root</span><span class="p">(</span><span class="n">rr</span><span class="o">=</span><span class="n">oldrr</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bic</span> <span class="o">=</span> <span class="n">bicOld</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sse</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">sseOld</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">par_valuesOld</span>
            <span class="n">dEB</span> <span class="o">+=</span> <span class="p">(</span><span class="n">bicNew</span> <span class="o">-</span> <span class="n">bicOld</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">par_valuesNew</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
        <span class="c1"># Done</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dEB</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dEB</span><span class="p">)</span>
            <span class="n">dEP</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dEP</span><span class="p">)</span>
            <span class="n">dE</span> <span class="o">=</span> <span class="n">dEB</span> <span class="o">+</span> <span class="n">dEP</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">dEB</span><span class="p">,</span> <span class="n">dEP</span><span class="p">,</span> <span class="n">dE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">return</span> <span class="n">dE</span><span class="p">,</span> <span class="n">dEB</span><span class="p">,</span> <span class="n">dEP</span><span class="p">,</span> <span class="n">par_valuesNew</span>

    <span class="c1"># Root replacement</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Check if the new tree is canonically acceptable.</span>
        <span class="c1"># replace</span>
        <span class="n">old_bic</span><span class="p">,</span> <span class="n">old_sse</span><span class="p">,</span> <span class="n">old_energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span>
        <span class="n">old_par_values</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
        <span class="n">newroot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace_root</span><span class="p">(</span><span class="n">rr</span><span class="o">=</span><span class="n">rr</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">newroot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Root cannot be replaced (due to max_size)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
        <span class="c1"># check/update canonical representative</span>
        <span class="n">rep_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_representative</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rep_res</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="c1"># this formula is forbidden</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prune_root</span><span class="p">(</span><span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">old_bic</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">old_sse</span><span class="p">),</span> <span class="n">old_energy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">old_par_values</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
        <span class="c1"># leave the whole thing as it was before the back &amp; fore</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prune_root</span><span class="p">(</span><span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">old_bic</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">old_sse</span><span class="p">),</span> <span class="n">old_energy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">old_par_values</span>

        <span class="c1"># Prior: change due to the numbers of each operation</span>
        <span class="n">dEP</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span><span class="p">[</span><span class="s2">&quot;Nopi_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">rr</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dEP</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span><span class="p">[</span><span class="s2">&quot;Nopi2_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">rr</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">rr</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">rr</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Data</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">bicOld</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bic</span>
            <span class="n">sseOld</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">)</span>
            <span class="n">par_valuesOld</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
            <span class="c1"># replace</span>
            <span class="n">newroot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace_root</span><span class="p">(</span><span class="n">rr</span><span class="o">=</span><span class="n">rr</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">newroot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span>
            <span class="n">bicNew</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bic</span><span class="p">(</span><span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="n">par_valuesNew</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
            <span class="c1"># leave the whole thing as it was before the back &amp; fore</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prune_root</span><span class="p">(</span><span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bic</span> <span class="o">=</span> <span class="n">bicOld</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sse</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">sseOld</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">par_valuesOld</span>
            <span class="n">dEB</span> <span class="o">+=</span> <span class="p">(</span><span class="n">bicNew</span> <span class="o">-</span> <span class="n">bicOld</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">par_valuesNew</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">)</span>
        <span class="c1"># Done</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dEB</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dEB</span><span class="p">)</span>
            <span class="n">dEP</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dEP</span><span class="p">)</span>
            <span class="n">dE</span> <span class="o">=</span> <span class="n">dEB</span> <span class="o">+</span> <span class="n">dEP</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">dEB</span><span class="p">,</span> <span class="n">dEP</span><span class="p">,</span> <span class="n">dE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">return</span> <span class="n">dE</span><span class="p">,</span> <span class="n">dEB</span><span class="p">,</span> <span class="n">dEP</span><span class="p">,</span> <span class="n">par_valuesNew</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autora.theorist.bms.mcmc.Tree.et_replace" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">et_replace</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Replace one elementary tree with another one, both of arbitrary order. target is a
Node and new is a tuple [node_value, [list, of, offspring, values]]</p>
<p>Returns: target</p>


            <details class="quote">
              <summary>Source code in <code>temp_dir/bms/src/autora/theorist/bms/mcmc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">et_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Replace one elementary tree with another one, both of arbitrary order. target is a</span>
<span class="sd">    Node and new is a tuple [node_value, [list, of, offspring, values]]</span>

<span class="sd">    Returns: target</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">oini</span><span class="p">,</span> <span class="n">ofin</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">offspring</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">new</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">oini</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">added</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_et</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">et</span><span class="o">=</span><span class="n">new</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ofin</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">added</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_del_et</span><span class="p">(</span>
                <span class="n">target</span><span class="p">,</span> <span class="n">leaf</span><span class="o">=</span><span class="n">new</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_del_et</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="n">added</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_et</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">et</span><span class="o">=</span><span class="n">new</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="c1"># Update goodness of fit measures, if necessary</span>
    <span class="k">if</span> <span class="n">update_gof</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sse</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bic</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="c1"># Done</span>
    <span class="k">return</span> <span class="n">added</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autora.theorist.bms.mcmc.Tree.get_bic" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_bic</span><span class="p">(</span><span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the Bayesian information criterion (BIC) of the current expression,
given the data. If reset==False, the value of self.bic will not be updated
(by default, it will)</p>
<p>Returns: Bayesian information criterion (BIC)</p>


            <details class="quote">
              <summary>Source code in <code>temp_dir/bms/src/autora/theorist/bms/mcmc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_bic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the Bayesian information criterion (BIC) of the current expression,</span>
<span class="sd">    given the data. If reset==False, the value of self.bic will not be updated</span>
<span class="sd">    (by default, it will)</span>

<span class="sd">    Returns: Bayesian information criterion (BIC)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span> <span class="ow">or</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">reset</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bic</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="c1"># Get the sum of squared errors (fitting, if required)</span>
    <span class="n">sse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sse</span><span class="p">(</span><span class="n">fit</span><span class="o">=</span><span class="n">fit</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="c1"># Calculate the BIC</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">])</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
    <span class="n">BIC</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sse</span><span class="p">[</span><span class="n">ds</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">BIC</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">ds</span><span class="p">])</span>
            <span class="n">BIC</span> <span class="o">+=</span> <span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="n">log</span><span class="p">(</span><span class="n">sse</span><span class="p">[</span><span class="n">ds</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="p">)</span>
    <span class="k">if</span> <span class="n">reset</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bic</span> <span class="o">=</span> <span class="n">BIC</span>
    <span class="k">return</span> <span class="n">BIC</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autora.theorist.bms.mcmc.Tree.get_energy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_energy</span><span class="p">(</span><span class="n">bic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the "energy" of a given formula, that is, approximate minus log-posterior
of the formula given the data (the approximation coming from the use of the BIC
instead of the exactly integrated likelihood)</p>
<p>Returns: Energy of formula (as E, EB, and EP)</p>


            <details class="quote">
              <summary>Source code in <code>temp_dir/bms/src/autora/theorist/bms/mcmc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the &quot;energy&quot; of a given formula, that is, approximate minus log-posterior</span>
<span class="sd">    of the formula given the data (the approximation coming from the use of the BIC</span>
<span class="sd">    instead of the exactly integrated likelihood)</span>

<span class="sd">    Returns: Energy of formula (as E, EB, and EP)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Contribution of the data (recalculating BIC if necessary)</span>
    <span class="k">if</span> <span class="n">bic</span><span class="p">:</span>
        <span class="n">EB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bic</span><span class="p">(</span><span class="n">reset</span><span class="o">=</span><span class="n">reset</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">EB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bic</span> <span class="o">/</span> <span class="mf">2.0</span>
    <span class="c1"># Contribution from the prior</span>
    <span class="n">EP</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">op</span><span class="p">,</span> <span class="n">nop</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">EP</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span><span class="p">[</span><span class="s2">&quot;Nopi_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">op</span><span class="p">]</span> <span class="o">*</span> <span class="n">nop</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">EP</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_par</span><span class="p">[</span><span class="s2">&quot;Nopi2_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">op</span><span class="p">]</span> <span class="o">*</span> <span class="n">nop</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="c1"># Reset the value, if necessary</span>
    <span class="k">if</span> <span class="n">reset</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EB</span> <span class="o">=</span> <span class="n">EB</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EP</span> <span class="o">=</span> <span class="n">EP</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">EB</span> <span class="o">+</span> <span class="n">EP</span>
    <span class="c1"># Done</span>
    <span class="k">return</span> <span class="n">EB</span> <span class="o">+</span> <span class="n">EP</span><span class="p">,</span> <span class="n">EB</span><span class="p">,</span> <span class="n">EP</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autora.theorist.bms.mcmc.Tree.get_sse" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_sse</span><span class="p">(</span><span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the sum of squared errors, fitting the expression represented by the Tree
to the existing data, if specified (by default, yes)</p>
<p>Returns: sum of square errors (sse)</p>


            <details class="quote">
              <summary>Source code in <code>temp_dir/bms/src/autora/theorist/bms/mcmc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_sse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the sum of squared errors, fitting the expression represented by the Tree</span>
<span class="sd">    to the existing data, if specified (by default, yes)</span>

<span class="sd">    Returns: sum of square errors (sse)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Return 0 if there is no data</span>
    <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span> <span class="ow">or</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sse</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="c1"># Convert the Tree into a SymPy expression</span>
    <span class="n">ex</span> <span class="o">=</span> <span class="n">sympify</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
    <span class="c1"># Convert the expression to a function that can be used by</span>
    <span class="c1"># curve_fit, i.e. that takes as arguments (x, a0, a1, ..., an)</span>
    <span class="n">atomd</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ex</span><span class="o">.</span><span class="n">atoms</span><span class="p">()</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">is_Symbol</span><span class="p">])</span>
    <span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="n">atomd</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">atomd</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="n">atomd</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">atomd</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
    <span class="n">dic</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;fac&quot;</span><span class="p">:</span> <span class="n">scipy</span><span class="o">.</span><span class="n">special</span><span class="o">.</span><span class="n">factorial</span><span class="p">,</span>
            <span class="s2">&quot;sig&quot;</span><span class="p">:</span> <span class="n">scipy</span><span class="o">.</span><span class="n">special</span><span class="o">.</span><span class="n">expit</span><span class="p">,</span>
            <span class="s2">&quot;relu&quot;</span><span class="p">:</span> <span class="n">relu</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">custom_ops</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">flam</span> <span class="o">=</span> <span class="n">lambdify</span><span class="p">(</span>
            <span class="n">variables</span> <span class="o">+</span> <span class="n">parameters</span><span class="p">,</span>
            <span class="n">ex</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s2">&quot;numpy&quot;</span><span class="p">,</span>
                <span class="n">dic</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sse</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">ds</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sse</span>
    <span class="k">if</span> <span class="n">fit</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Nothing to fit</span>
            <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">[</span><span class="n">ds</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_par</span><span class="p">:</span>  <span class="c1"># Recover previously fit parameters</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_par</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Do the fit for all datasets</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_par</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">:</span>
                <span class="n">this_x</span><span class="p">,</span> <span class="n">this_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ds</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">ds</span><span class="p">]</span>
                <span class="n">xmat</span> <span class="o">=</span> <span class="p">[</span><span class="n">this_x</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">]</span>

                <span class="k">def</span><span class="w"> </span><span class="nf">feval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">):</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">xi</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="p">]</span>
                    <span class="k">return</span> <span class="n">flam</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Fit the parameters</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span>
                        <span class="n">feval</span><span class="p">,</span>
                        <span class="n">xmat</span><span class="p">,</span>
                        <span class="n">this_y</span><span class="p">,</span>
                        <span class="n">p0</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">[</span><span class="n">ds</span><span class="p">][</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">],</span>
                        <span class="n">maxfev</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="c1"># Reassign the values of the parameters</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">[</span><span class="n">ds</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">[</span><span class="n">ds</span><span class="p">]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">[</span><span class="n">ds</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
                    <span class="c1"># Save this fit</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fit_par</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)][</span><span class="n">ds</span><span class="p">]</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">[</span><span class="n">ds</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
                    <span class="c1"># Save this (unsuccessful) fit and print warning</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fit_par</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)][</span><span class="n">ds</span><span class="p">]</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">[</span><span class="n">ds</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span>
                            <span class="s2">&quot;#Cannot_fit:</span><span class="si">%s</span><span class="s2"> # # # # #&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                            <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
                        <span class="p">)</span>

    <span class="c1"># Sum of squared errors</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sse</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">:</span>
        <span class="n">this_x</span><span class="p">,</span> <span class="n">this_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ds</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">ds</span><span class="p">]</span>
        <span class="n">xmat</span> <span class="o">=</span> <span class="p">[</span><span class="n">this_x</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">]</span>
        <span class="n">ar</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">xmat</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">[</span><span class="n">ds</span><span class="p">][</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parameters</span>
        <span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">se</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">this_y</span> <span class="o">-</span> <span class="n">flam</span><span class="p">(</span><span class="o">*</span><span class="n">ar</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">se</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">[</span><span class="n">ds</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">se</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&gt; Cannot calculate SSE for </span><span class="si">%s</span><span class="s2">: inf&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">[</span><span class="n">ds</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Complex-valued parameters are invalid&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sse</span><span class="p">[</span><span class="n">ds</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

    <span class="c1"># Done</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sse</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autora.theorist.bms.mcmc.Tree.is_root_prunable" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_root_prunable</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Check if the root is "prunable"</p>
<p>Returns: boolean of root "prunability"</p>


            <details class="quote">
              <summary>Source code in <code>temp_dir/bms/src/autora/theorist/bms/mcmc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_root_prunable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if the root is &quot;prunable&quot;</span>

<span class="sd">    Returns: boolean of root &quot;prunability&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">isPrunable</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">isPrunable</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">isPrunable</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">offspring</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">offspring</span> <span class="o">!=</span> <span class="p">[]:</span>
                <span class="n">isPrunable</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">break</span>
    <span class="k">return</span> <span class="n">isPrunable</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autora.theorist.bms.mcmc.Tree.latex" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">latex</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>translate equation into latex</p>
<p>Returns: canonical latex form of equation</p>


            <details class="quote">
              <summary>Source code in <code>temp_dir/bms/src/autora/theorist/bms/mcmc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">latex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    translate equation into latex</span>

<span class="sd">    Returns: canonical latex form of equation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">latex</span><span class="p">(</span><span class="n">sympify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canonical</span><span class="p">()))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autora.theorist.bms.mcmc.Tree.mcmc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mcmc</span><span class="p">(</span><span class="n">tracefn</span><span class="o">=</span><span class="s1">&#39;trace.dat&#39;</span><span class="p">,</span> <span class="n">progressfn</span><span class="o">=</span><span class="s1">&#39;progress.dat&#39;</span><span class="p">,</span> <span class="n">write_files</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">reset_files</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">burnin</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">thin</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Sample the space of formula trees using MCMC, and write the trace and some progress
information to files (unless write_files is False)</p>
<p>Returns: None or expression list</p>


            <details class="quote">
              <summary>Source code in <code>temp_dir/bms/src/autora/theorist/bms/mcmc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">mcmc</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">tracefn</span><span class="o">=</span><span class="s2">&quot;trace.dat&quot;</span><span class="p">,</span>
    <span class="n">progressfn</span><span class="o">=</span><span class="s2">&quot;progress.dat&quot;</span><span class="p">,</span>
    <span class="n">write_files</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">reset_files</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">burnin</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
    <span class="n">thin</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">samples</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sample the space of formula trees using MCMC, and write the trace and some progress</span>
<span class="sd">    information to files (unless write_files is False)</span>

<span class="sd">    Returns: None or expression list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">get_energy</span><span class="p">(</span><span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="c1"># Burning</span>
    <span class="k">if</span> <span class="n">progress</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# Burning in</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\b</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">50</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">burnin</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mcmc_step</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">progress</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="p">(</span><span class="n">burnin</span> <span class="o">/</span> <span class="mi">50</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="c1"># Sample</span>
    <span class="k">if</span> <span class="n">write_files</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">reset_files</span><span class="p">:</span>
            <span class="n">tracef</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">tracefn</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="n">progressf</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">progressfn</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tracef</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">tracefn</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>
            <span class="n">progressf</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">progressfn</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">progress</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"># Sampling</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\b</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">50</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">thin</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mcmc_step</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">progress</span> <span class="ow">and</span> <span class="p">(</span><span class="n">s</span> <span class="o">%</span> <span class="p">(</span><span class="n">samples</span> <span class="o">/</span> <span class="mi">50</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">write_files</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">s</span><span class="p">,</span>
                    <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">),</span>
                    <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">),</span>
                    <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_energy</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)),</span>
                    <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">tracef</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">tracef</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">tracef</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">progressf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%lf</span><span class="s2"> </span><span class="si">%lf</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">))</span>
            <span class="n">progressf</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="c1"># Done</span>
    <span class="k">if</span> <span class="n">progress</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autora.theorist.bms.mcmc.Tree.mcmc_step" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mcmc_step</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">p_rr</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">p_long</span><span class="o">=</span><span class="mf">0.45</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Make a single MCMC step</p>
<p>Returns: None or expression list</p>


            <details class="quote">
              <summary>Source code in <code>temp_dir/bms/src/autora/theorist/bms/mcmc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">mcmc_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">p_rr</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">p_long</span><span class="o">=</span><span class="mf">0.45</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make a single MCMC step</span>

<span class="sd">    Returns: None or expression list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">topDice</span> <span class="o">=</span> <span class="n">random</span><span class="p">()</span>
    <span class="c1"># Root replacement move</span>
    <span class="k">if</span> <span class="n">topDice</span> <span class="o">&lt;</span> <span class="n">p_rr</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="c1"># Try to prune the root</span>
            <span class="n">dE</span><span class="p">,</span> <span class="n">dEB</span><span class="p">,</span> <span class="n">dEP</span><span class="p">,</span> <span class="n">par_valuesNew</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dE_rr</span><span class="p">(</span><span class="n">rr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="k">if</span> <span class="o">-</span><span class="n">dEB</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">BT</span> <span class="o">-</span> <span class="n">dEP</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">PT</span> <span class="o">&gt;</span> <span class="mi">300</span><span class="p">:</span>
                <span class="n">paccept</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">paccept</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">dEB</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">BT</span> <span class="o">-</span> <span class="n">dEP</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">PT</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">num_rr</span>
                <span class="p">)</span>
            <span class="n">dice</span> <span class="o">=</span> <span class="n">random</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dice</span> <span class="o">&lt;</span> <span class="n">paccept</span><span class="p">:</span>
                <span class="c1"># Accept move</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prune_root</span><span class="p">(</span><span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">par_valuesNew</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_bic</span><span class="p">(</span><span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">+=</span> <span class="n">dE</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">EB</span> <span class="o">+=</span> <span class="n">dEB</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">EP</span> <span class="o">+=</span> <span class="n">dEP</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Try to replace the root</span>
            <span class="n">newrr</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rr_space</span><span class="p">)</span>
            <span class="n">dE</span><span class="p">,</span> <span class="n">dEB</span><span class="p">,</span> <span class="n">dEP</span><span class="p">,</span> <span class="n">par_valuesNew</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dE_rr</span><span class="p">(</span><span class="n">rr</span><span class="o">=</span><span class="n">newrr</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rr</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="o">-</span><span class="n">dEB</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">BT</span> <span class="o">-</span> <span class="n">dEP</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">PT</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">paccept</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">paccept</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">paccept</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rr</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">dEB</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">BT</span> <span class="o">-</span> <span class="n">dEP</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">PT</span><span class="p">)</span>
            <span class="n">dice</span> <span class="o">=</span> <span class="n">random</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dice</span> <span class="o">&lt;</span> <span class="n">paccept</span><span class="p">:</span>
                <span class="c1"># Accept move</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">replace_root</span><span class="p">(</span><span class="n">rr</span><span class="o">=</span><span class="n">newrr</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">par_valuesNew</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_bic</span><span class="p">(</span><span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">+=</span> <span class="n">dE</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">EB</span> <span class="o">+=</span> <span class="n">dEB</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">EP</span> <span class="o">+=</span> <span class="n">dEP</span>

    <span class="c1"># Long-range move</span>
    <span class="k">elif</span> <span class="n">topDice</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">p_rr</span> <span class="o">+</span> <span class="n">p_long</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixed_root</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="p">):</span>
        <span class="c1"># Choose a random node in the tree, and a random new operation</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_root</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">target</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
        <span class="n">nready</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">nready</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">offspring</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">new</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
                <span class="n">nready</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="n">new</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">value</span><span class="p">]:</span>
                    <span class="n">nready</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">dE</span><span class="p">,</span> <span class="n">dEB</span><span class="p">,</span> <span class="n">dEP</span><span class="p">,</span> <span class="n">par_valuesNew</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dE_lr</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">paccept</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">dEB</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">BT</span> <span class="o">-</span> <span class="n">dEP</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">PT</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Potentially failing to set paccept properly&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">dEB</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">BT</span> <span class="o">+</span> <span class="n">dEP</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">PT</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">paccept</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="c1"># Accept move, if necessary</span>
        <span class="n">dice</span> <span class="o">=</span> <span class="n">random</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">dice</span> <span class="o">&lt;</span> <span class="n">paccept</span><span class="p">:</span>
            <span class="c1"># update number of operations</span>
            <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">offspring</span> <span class="o">!=</span> <span class="p">[]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="n">new</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># move</span>
            <span class="n">target</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">new</span>
            <span class="c1"># recalculate distinct parameters</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dist_par</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">([</span><span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">])</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_dist_par</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_par</span><span class="p">)</span>
            <span class="c1"># update others</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">par_valuesNew</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_bic</span><span class="p">(</span><span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">+=</span> <span class="n">dE</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EB</span> <span class="o">+=</span> <span class="n">dEB</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EP</span> <span class="o">+=</span> <span class="n">dEP</span>

    <span class="c1"># Elementary tree (short-range) move</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">target</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">while</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_root</span> <span class="ow">and</span> <span class="n">target</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span>
            <span class="c1"># Choose a feasible move (doable and keeping size&lt;=max_size)</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">oini</span><span class="p">,</span> <span class="n">ofin</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">move_types</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="n">oini</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="n">oini</span> <span class="o">+</span> <span class="n">ofin</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span>
                <span class="p">):</span>
                    <span class="k">break</span>
            <span class="c1"># target and new ETs</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="n">oini</span><span class="p">])</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">et_space</span><span class="p">[</span><span class="n">ofin</span><span class="p">])</span>
        <span class="c1"># omegai and omegaf</span>
        <span class="n">omegai</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="n">oini</span><span class="p">])</span>
        <span class="n">omegaf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="n">ofin</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">ofin</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">omegaf</span> <span class="o">-=</span> <span class="n">oini</span>
        <span class="k">if</span> <span class="n">oini</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">target</span><span class="o">.</span><span class="n">parent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="n">ofin</span><span class="p">]:</span>
            <span class="n">omegaf</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="c1"># size of et_space of each type</span>
        <span class="n">si</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">et_space</span><span class="p">[</span><span class="n">oini</span><span class="p">])</span>
        <span class="n">sf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">et_space</span><span class="p">[</span><span class="n">ofin</span><span class="p">])</span>
        <span class="c1"># Probability of acceptance</span>
        <span class="n">dE</span><span class="p">,</span> <span class="n">dEB</span><span class="p">,</span> <span class="n">dEP</span><span class="p">,</span> <span class="n">par_valuesNew</span><span class="p">,</span> <span class="n">nif</span><span class="p">,</span> <span class="n">nfi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dE_et</span><span class="p">(</span>
            <span class="n">target</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">paccept</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">nif</span><span class="p">)</span> <span class="o">*</span> <span class="n">omegai</span> <span class="o">*</span> <span class="n">sf</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">dEB</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">BT</span> <span class="o">-</span> <span class="n">dEP</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">PT</span><span class="p">)</span>
            <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">nfi</span><span class="p">)</span> <span class="o">*</span> <span class="n">omegaf</span> <span class="o">*</span> <span class="n">si</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">dEB</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">BT</span> <span class="o">+</span> <span class="n">dEP</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">PT</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">200</span><span class="p">:</span>
                <span class="n">paccept</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="c1"># Accept / reject</span>
        <span class="n">dice</span> <span class="o">=</span> <span class="n">random</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">dice</span> <span class="o">&lt;</span> <span class="n">paccept</span><span class="p">:</span>
            <span class="c1"># Accept move</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">et_replace</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span> <span class="o">=</span> <span class="n">par_valuesNew</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_bic</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">+=</span> <span class="n">dE</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EB</span> <span class="o">+=</span> <span class="n">dEB</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EP</span> <span class="o">+=</span> <span class="n">dEP</span>

    <span class="c1"># Done</span>
    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autora.theorist.bms.mcmc.Tree.pr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pr</span><span class="p">(</span><span class="n">show_pow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns readable representation of tree's root node</p>
<p>Returns: root node representation</p>


            <details class="quote">
              <summary>Source code in <code>temp_dir/bms/src/autora/theorist/bms/mcmc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_pow</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns readable representation of tree&#39;s root node</span>

<span class="sd">    Returns: root node representation</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="n">custom_ops</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">custom_ops</span><span class="p">,</span> <span class="n">show_pow</span><span class="o">=</span><span class="n">show_pow</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autora.theorist.bms.mcmc.Tree.predict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the value of the formula at the given data x. The data x
must have the same format as the training data and, in particular, it
it must specify to which dataset the example data belongs, if multiple
datasets where used for training.</p>
<p>Returns: predicted y values</p>


            <details class="quote">
              <summary>Source code in <code>temp_dir/bms/src/autora/theorist/bms/mcmc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the value of the formula at the given data x. The data x</span>
<span class="sd">    must have the same format as the training data and, in particular, it</span>
<span class="sd">    it must specify to which dataset the example data belongs, if multiple</span>
<span class="sd">    datasets where used for training.</span>

<span class="sd">    Returns: predicted y values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;X&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">this_x</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;d0&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">}</span>
        <span class="n">input_type</span> <span class="o">=</span> <span class="s2">&quot;df&quot;</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">this_x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">input_type</span> <span class="o">=</span> <span class="s2">&quot;dict&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;x must be either a dict or a pandas.DataFrame&quot;</span><span class="p">)</span>

    <span class="c1"># Convert the Tree into a SymPy expression</span>
    <span class="n">ex</span> <span class="o">=</span> <span class="n">sympify</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
    <span class="c1"># Convert the expression to a function</span>
    <span class="n">atomd</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ex</span><span class="o">.</span><span class="n">atoms</span><span class="p">()</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">is_Symbol</span><span class="p">])</span>
    <span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="n">atomd</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">atomd</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="n">atomd</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">atomd</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
    <span class="n">flam</span> <span class="o">=</span> <span class="n">lambdify</span><span class="p">(</span>
        <span class="n">variables</span> <span class="o">+</span> <span class="n">parameters</span><span class="p">,</span>
        <span class="n">ex</span><span class="p">,</span>
        <span class="p">[</span>
            <span class="s2">&quot;numpy&quot;</span><span class="p">,</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;fac&quot;</span><span class="p">:</span> <span class="n">scipy</span><span class="o">.</span><span class="n">special</span><span class="o">.</span><span class="n">factorial</span><span class="p">,</span>
                    <span class="s2">&quot;sig&quot;</span><span class="p">:</span> <span class="n">scipy</span><span class="o">.</span><span class="n">special</span><span class="o">.</span><span class="n">expit</span><span class="p">,</span>
                    <span class="s2">&quot;relu&quot;</span><span class="p">:</span> <span class="n">relu</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">custom_ops</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">],</span>
    <span class="p">)</span>
    <span class="c1"># Loop over datasets</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">this_x</span><span class="p">:</span>
        <span class="c1"># Prepare variables and parameters</span>
        <span class="n">xmat</span> <span class="o">=</span> <span class="p">[</span><span class="n">this_x</span><span class="p">[</span><span class="n">ds</span><span class="p">][</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">[</span><span class="n">ds</span><span class="p">][</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">]</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">xi</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">xmat</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="p">]</span>
        <span class="c1"># Predict</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">prediction</span> <span class="o">=</span> <span class="n">flam</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
            <span class="c1"># Do it point by point</span>
            <span class="n">prediction</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">this_x</span><span class="p">[</span><span class="n">ds</span><span class="p">]))]</span>
        <span class="n">predictions</span><span class="p">[</span><span class="n">ds</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">this_x</span><span class="p">[</span><span class="n">ds</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">input_type</span> <span class="o">==</span> <span class="s2">&quot;df&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;d0&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">predictions</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autora.theorist.bms.mcmc.Tree.prune_root" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">prune_root</span><span class="p">(</span><span class="n">update_gof</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Cut the root and its rightmost leaves (provided they are, indeed, leaves),
leaving the leftmost branch as the new tree. Returns the pruned root with the same format
as the replacement roots in self.rr_space (or None if pruning was impossible)</p>
<p>Returns: the replacement root</p>


            <details class="quote">
              <summary>Source code in <code>temp_dir/bms/src/autora/theorist/bms/mcmc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prune_root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cut the root and its rightmost leaves (provided they are, indeed, leaves),</span>
<span class="sd">    leaving the leftmost branch as the new tree. Returns the pruned root with the same format</span>
<span class="sd">    as the replacement roots in self.rr_space (or None if pruning was impossible)</span>

<span class="sd">    Returns: the replacement root</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if the root is &quot;prunable&quot; (and return None if not)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_root_prunable</span><span class="p">():</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="c1"># Let&#39;s do it!</span>
    <span class="n">rr</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">[]]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">offspring</span><span class="p">)]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">offspring</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">rr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">offspring</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># Update list of distinct parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dist_par</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
        <span class="nb">set</span><span class="p">([</span><span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">])</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">n_dist_par</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_par</span><span class="p">)</span>
    <span class="c1"># Update goodness of fit measures, if necessary</span>
    <span class="k">if</span> <span class="n">update_gof</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sse</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bic</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_energy</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="c1"># Done</span>
    <span class="k">return</span> <span class="n">rr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autora.theorist.bms.mcmc.Tree.replace_root" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">replace_root</span><span class="p">(</span><span class="n">rr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Replace the root with a "root replacement" rr (if provided;
otherwise choose one at random from self.rr_space)</p>
<p>Returns: new root (if move was possible) or None (otherwise)</p>


            <details class="quote">
              <summary>Source code in <code>temp_dir/bms/src/autora/theorist/bms/mcmc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">replace_root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">update_gof</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Replace the root with a &quot;root replacement&quot; rr (if provided;</span>
<span class="sd">    otherwise choose one at random from self.rr_space)</span>

<span class="sd">    Returns: new root (if move was possible) or None (otherwise)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If no RR is provided, randomly choose one</span>
    <span class="k">if</span> <span class="n">rr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rr</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rr_space</span><span class="p">)</span>
    <span class="c1"># Return None if the replacement is too big</span>
    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="n">rr</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="c1"># Create the new root and replace existing root</span>
    <span class="n">newRoot</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">rr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">offspring</span><span class="o">=</span><span class="p">[],</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">newRoot</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">rr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">newRoot</span><span class="o">.</span><span class="n">order</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="n">rr</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span>
        <span class="k">raise</span>
    <span class="n">newRoot</span><span class="o">.</span><span class="n">offspring</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">newRoot</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">newRoot</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nops</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">oldRoot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">offspring</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">leaf</span> <span class="ow">in</span> <span class="n">rr</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">offspring</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="n">leaf</span><span class="p">,</span> <span class="n">offspring</span><span class="o">=</span><span class="p">[],</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">offspring</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">offspring</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1"># Add new root to elementary trees if necessary (that is, iff</span>
    <span class="c1"># the old root was a leaf)</span>
    <span class="k">if</span> <span class="n">oldRoot</span><span class="o">.</span><span class="n">offspring</span> <span class="ow">is</span> <span class="p">[]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">order</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
    <span class="c1"># Update list of distinct parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dist_par</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
        <span class="nb">set</span><span class="p">([</span><span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">])</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">n_dist_par</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_par</span><span class="p">)</span>
    <span class="c1"># Update goodness of fit measures, if necessary</span>
    <span class="k">if</span> <span class="n">update_gof</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sse</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bic</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_energy</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autora.theorist.bms.mcmc.Tree.trace_predict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">trace_predict</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">burnin</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">thin</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">tracefn</span><span class="o">=</span><span class="s1">&#39;trace.dat&#39;</span><span class="p">,</span> <span class="n">progressfn</span><span class="o">=</span><span class="s1">&#39;progress.dat&#39;</span><span class="p">,</span> <span class="n">write_files</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">reset_files</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Sample the space of formula trees using MCMC,
and predict y(x) for each of the sampled formula trees</p>
<p>Returns: predicted y values for each of the sampled formula trees</p>


            <details class="quote">
              <summary>Source code in <code>temp_dir/bms/src/autora/theorist/bms/mcmc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">trace_predict</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">burnin</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">thin</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
    <span class="n">samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">tracefn</span><span class="o">=</span><span class="s2">&quot;trace.dat&quot;</span><span class="p">,</span>
    <span class="n">progressfn</span><span class="o">=</span><span class="s2">&quot;progress.dat&quot;</span><span class="p">,</span>
    <span class="n">write_files</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">reset_files</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sample the space of formula trees using MCMC,</span>
<span class="sd">    and predict y(x) for each of the sampled formula trees</span>

<span class="sd">    Returns: predicted y values for each of the sampled formula trees</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ypred</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># Burning</span>
    <span class="k">if</span> <span class="n">progress</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# Burning in</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\b</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">50</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">burnin</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mcmc_step</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">progress</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="p">(</span><span class="n">burnin</span> <span class="o">/</span> <span class="mi">50</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="c1"># Sample</span>
    <span class="k">if</span> <span class="n">write_files</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">reset_files</span><span class="p">:</span>
            <span class="n">tracef</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">tracefn</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="n">progressf</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">progressfn</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tracef</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">tracefn</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>
            <span class="n">progressf</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">progressfn</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">progress</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"># Sampling</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\b</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">50</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">thin</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mcmc_step</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="c1"># Make prediction</span>
        <span class="n">ypred</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="c1"># Output</span>
        <span class="k">if</span> <span class="n">progress</span> <span class="ow">and</span> <span class="p">(</span><span class="n">s</span> <span class="o">%</span> <span class="p">(</span><span class="n">samples</span> <span class="o">/</span> <span class="mi">50</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">write_files</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">s</span><span class="p">,</span>
                    <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">),</span>
                    <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">),</span>
                    <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_energy</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)),</span>
                    <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">tracef</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">tracef</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">tracef</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">progressf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%lf</span><span class="s2"> </span><span class="si">%lf</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">))</span>
            <span class="n">progressf</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="c1"># Done</span>
    <span class="k">if</span> <span class="n">progress</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">ypred</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="autora.theorist.bms.mcmc.Tree.update_representative" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_representative</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Check if we've seen this formula before, either in its current form
or in another form.</p>
<p>*If we haven't seen it, save it and return 1.</p>
<p>*If we have seen it and this IS the representative, just return 0.</p>
<p>*If we have seen it and the representative has smaller energy, just return -1.</p>
<p>*If we have seen it and the representative has higher energy, update
the representatitve and return -2.</p>


    <p><span class="doc-section-title">Integer value (0, 1, or -1) corresponding to:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>0</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>we have seen this canonical form before</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>1</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>we haven't seen this canonical form before</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>-1: we have seen this equation's canonical form before but it isn't in that form yet</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>temp_dir/bms/src/autora/theorist/bms/mcmc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_representative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if we&#39;ve seen this formula before, either in its current form</span>
<span class="sd">    or in another form.</span>

<span class="sd">    *If we haven&#39;t seen it, save it and return 1.</span>

<span class="sd">    *If we have seen it and this IS the representative, just return 0.</span>

<span class="sd">    *If we have seen it and the representative has smaller energy, just return -1.</span>

<span class="sd">    *If we have seen it and the representative has higher energy, update</span>
<span class="sd">    the representatitve and return -2.</span>

<span class="sd">    Returns: Integer value (0, 1, or -1) corresponding to:</span>
<span class="sd">        0: we have seen this canonical form before</span>
<span class="sd">        1: we haven&#39;t seen this canonical form before</span>
<span class="sd">        -1: we have seen this equation&#39;s canonical form before but it isn&#39;t in that form yet</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check for canonical representative</span>
    <span class="n">canonical</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canonical</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>  <span class="c1"># We&#39;ve seen this canonical before!</span>
        <span class="n">rep</span><span class="p">,</span> <span class="n">rep_energy</span><span class="p">,</span> <span class="n">rep_par_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">representative</span><span class="p">[</span><span class="n">canonical</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># Complex-valued parameters are invalid</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>  <span class="c1"># Never seen this canonical formula before:</span>
        <span class="c1"># save it and return 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_bic</span><span class="p">(</span><span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">new_energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_energy</span><span class="p">(</span><span class="n">bic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">representative</span><span class="p">[</span><span class="n">canonical</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
            <span class="n">new_energy</span><span class="p">,</span>
            <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_values</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="c1"># If we&#39;ve seen this canonical before, check if the</span>
    <span class="c1"># representative needs to be updated</span>
    <span class="k">if</span> <span class="n">rep</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># This IS the representative: return 0</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.indexes", "content.code.copy", "announce.dismiss"], "search": "../../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="../../../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
      
    
  </body>
</html>